
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>DeltaX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Draven">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="DeltaX">
<meta property="og:url" content="http://deltax.me/index.html">
<meta property="og:site_name" content="DeltaX">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DeltaX">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="DeltaX" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="DeltaX" title="DeltaX"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="DeltaX">DeltaX</a></h1>
				<h2 class="blog-motto">为了成为牛逼闪闪的工程师</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:deltax.me">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/23/Class-as-Data-Abstraction-in-OOP/" title="Class as Data Abstraction in OOP" itemprop="url">Class as Data Abstraction in OOP</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-23T02:28:07.000Z" itemprop="datePublished"> 發表於 2015-03-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>The heart of the object concept is controlled access to encapsulated data. The behaviour of an object is specified by a <strong>class</strong> which is an incremental definition of a data abstraction.</p>
<ul>
<li>Complete data abstraction<ul>
<li>Defining the various elements that make up a class.</li>
<li>Taking advantage of dynamic typing.</li>
</ul>
</li>
<li>Incremental data abstraction<ul>
<li>Related to inheritance.</li>
</ul>
</li>
</ul>
<h2 id="Defining_Classes_and_Objects">Defining Classes and Objects</h2><p>A class is data structure that defines an object’s internal state (attributes), its behavior (methods), the classes it inherits several properties and operations.</p>
<p>A class is a data abstraction that give its partial and total implementation.</p>
<p>Objects of a given class is called <strong>instances</strong>. These object have differenty identities but can have differnet values for their interval state. And instance is initialized with the operation <code>New</code>.</p>
<pre><code>Obj={<span class="keyword">New</span> <span class="class"><span class="keyword">Class</span> <span class="title">Init</span>}</span>
</code></pre><p>This code creates an new object <code>Obj</code> of class <code>Class</code> and invokes with the message <code>Init</code>. And after the initialize, we can use the syntax <code>{Obj Message}</code> to call a message on instance <code>Obj</code>.</p>
<h2 id="Class_members">Class members</h2><p>A class defines the constituent parts part each of its object will have. There are three kinds of members in class:</p>
<ul>
<li><strong>Attributes</strong><blockquote>
<p>An attribute is a cell that contains part of the instance’s state which is always called <strong>instance variable</strong> in an instance. And this just visible in the class definition. Every instance have seperate set of attributes.</p>
</blockquote>
</li>
<li><p><strong>Methods</strong></p>
<blockquote>
<p>A method is a kind of procedure that is called in the context of a particular object and that access the object’s attribute. </p>
</blockquote>
<ul>
<li>The method consists of a head and body. </li>
<li>The head consists of a label, which must be an atom or a name, and a set of arguments.</li>
<li>The arguments must be distinct variables.</li>
</ul>
</li>
<li><strong>Properties</strong><blockquote>
<p>A property modifies how an object behaves.</p>
</blockquote>
</li>
</ul>
<h2 id="Initializing_Attributes">Initializing Attributes</h2><p>Attributes can be initialized in two ways: per instance or per class.</p>
<ul>
<li><p>Per instance</p>
<ul>
<li><p>An attribute can be given a different initial value per instance.</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">OneApt</span></span>
    attr streetName
    meth init(X) @streetName=X <span class="keyword">end</span>
<span class="keyword">end</span>
Apt1={<span class="keyword">New</span> OneApt init(drottninggatan)}
Apt2={<span class="keyword">New</span> OneApt init(runNeuve)}
</code></pre></li>
</ul>
</li>
<li><p>Per class</p>
<ul>
<li><p>An attribute can be given a value that is the same for all instances of a class. This is done by initilizing it with “:” in the class definition.</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">YorkApt</span></span>
    attr
        streetName:york
        streetNumber:<span class="number">100</span>
        wallColor:_
        floorSurface:wood
    meth init skip <span class="keyword">end</span>
<span class="keyword">end</span>
Apt3={<span class="keyword">New</span> OneApt init}
Apt4={<span class="keyword">New</span> OneApt init}
</code></pre></li>
</ul>
</li>
<li><p>Per brand</p>
<ul>
<li><p>This is another way to use the per-class initialization. A brand is a set of classes that related in some way.</p>
<pre><code><span class="keyword">L</span>=linux
<span class="keyword">class</span> RedHat attr ostype:<span class="keyword">L</span> end
<span class="keyword">class</span> SuSE attr ostype:<span class="keyword">L</span> end
<span class="keyword">class</span> Debian attr ostype:<span class="keyword">L</span> end
</code></pre></li>
</ul>
</li>
</ul>
<h2 id="First-class_Messages">First-class Messages</h2><p>Messages are records and method heads are patterns that match a record. We can use different type of records to pass to a method.</p>
<ol>
<li>Static record as message. In this case, message is known at <strong>compile time</strong>.</li>
<li>Dynamic record as message. In this case, message is a variable that references a record that calculated at <strong>run time</strong>.</li>
</ol>
<p>In the method definition, the following approach is possible:</p>
<ol>
<li><p>Fixed argument list</p>
<pre><code>meth <span class="keyword">add</span>(x:X y:Y)
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre></li>
<li><p>Flexible argument list</p>
<pre><code>meth <span class="keyword">add</span>(x:X y:Y ...)
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre><p> The “…” in the method head means that any message is accepted if has least the listed argument.</p>
</li>
<li><p>Variable reference to method head</p>
<p> The whole method head is referenced by a variable.</p>
<pre><code>meth <span class="keyword">add</span>(x:X y:Y ...)=M
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre><p> The variable <code>M</code> references the full message as a record.</p>
</li>
<li><p>Optional argument</p>
<pre><code>meth <span class="keyword">add</span>(x:X y:Y z:Z&lt;=V)
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre><p> The <code>&lt;=V</code> in the method head means that field <code>z</code> is optional. You can either called the method with <code>add(x:1 y:2)</code> or <code>add(x:1 y:2 z:3)</code>.</p>
</li>
<li><p>Private method label</p>
<p> Method label can be names. This is denoted by using a variable identifier</p>
<pre><code>meth A(bar:X)
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre><p> The method <code>A</code> is bound to a fresh name whtn the class is defined. If this method must be used elsewhere in the program, we should pass it explicitly.</p>
</li>
<li><p>Dynamic method label</p>
<pre><code>meth !A(bar:X)
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre><p> The method label has to be known when the class definitions is executed. The variable must be bound to an atom or a name. This technique can make method secure.</p>
</li>
<li><p>The <code>otherwise</code> method</p>
<p> The method head with label <code>otherwise</code> is a catchall that accepts any message for message for which no other method exists.</p>
<pre><code>meth otherwise(M)
    % <span class="function"><span class="keyword">Method</span> <span class="title">body</span>
<span class="title">end</span></span>
</code></pre><p> A class has only one method with <code>otherwise</code>, if this method exists, it accepts any message.</p>
</li>
</ol>
<h2 id="First-class_Attributes">First-class Attributes</h2><p>Attribute names can be calculated at tun time. It is possible to write methods to access and assign any attributes.</p>
<pre><code>class Inspector
    meth <span class="built_in">get</span>(A ?X)
        X=@A
    <span class="function"><span class="keyword">end</span></span>
    meth <span class="built_in">set</span>(A X)
        A:=X
    <span class="function"><span class="keyword">end</span></span>
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>The <code>get</code> method can get any attribute, and the <code>set</code> method can assign any attribute.</p>
<h2 id="Programming_Techniques">Programming Techniques</h2><p>The class concept we have introduced so far gives a convenient syntax for defining data abstractions with excapsulated state and multiple operations.</p>
<ul>
<li>The class statement defines a class value, which can be instantiated to give objects.</li>
<li>Classes can have external references.</li>
<li>Classes are cmpositional, they can be nested within classes.</li>
<li>Classes are compatible with procedure values, they can be nested within procedures and vice versa.</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Programming-Paradigm/">Programming Paradigm</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/OOP/">OOP</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/22/快速排序/" title="快速排序" itemprop="url">快速排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-22T05:06:38.000Z" itemprop="datePublished"> 發表於 2015-03-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="http://zh.wikipedia.org/wiki/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F" target="_blank" rel="external">快速排序</a>使用分治法策略把一个数组分成两个子数组, 并对两个子数组递归排序.</p>
<p>快速排序的分治过程有三步:</p>
<ul>
<li>分解<ul>
<li>数组 <code>A[p..r]</code> 被分解为两个可能为空的子数组 <code>A[p..q-1]</code> 和 <code>A[q+1..r]</code>, 使 <code>A[p..q-1]</code> 中的所有元素都小于或等于 <code>A[q]</code>, <code>A[q+1..r]</code> 中的所有元素都大于或等于 <code>A[q]</code>.</li>
</ul>
</li>
<li>解决<ul>
<li>地柜地调用快速排序, 对子数组 <code>A[p..q-1]</code> 和 <code>A[q+1..r]</code> 进行排序.</li>
</ul>
</li>
<li>合并<ul>
<li>不需要合并操作, 数组 <code>A[p..r]</code> 已经有序.</li>
</ul>
</li>
</ul>
<h2 id="快速排序的实现">快速排序的实现</h2><pre><code><span class="function"><span class="keyword">void</span> <span class="title">quicksort</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> p, <span class="keyword">int</span> r)</span> </span>{
    <span class="keyword">if</span> (p &lt; r - <span class="number">1</span>) {
        <span class="keyword">int</span> q = partition(A, p, r);
        quicksort(A, p, q - <span class="number">1</span>);
        quicksort(A, q + <span class="number">1</span>, r);
    }
}
</code></pre><p>为了排序一个数组, 我们需要调用 `quicksort(A, 0, A.length - 1)</p>
<h2 id="数组的划分(partition)">数组的划分(partition)</h2><p>快速排序最关键的部分就是数组的划分, 也就是过程 <code>partition</code>, 它实现了对数组的重新排序.</p>
<pre><code><span class="comment">#define EXCHANGE(a, b) tmp = a; a = b; b = tmp;</span>

<span class="keyword">int</span> partition(<span class="keyword">int</span> A[], <span class="keyword">int</span> p, <span class="keyword">int</span> r) {
    <span class="keyword">int</span> <span class="keyword">x</span> = A[r],
         i = p - <span class="number">1</span>;

    <span class="keyword">for</span> (<span class="keyword">int</span> j = p; j &lt; r; j++) {
        <span class="keyword">if</span> (A[j] &lt;= <span class="keyword">x</span>) {
            i++;
            EXCHANGE(A[i], A[j]);
        }
    }
    EXCHANGE(A[r], A[i + <span class="number">1</span>]);
    <span class="keyword">return</span> i + <span class="number">1</span>;
}
</code></pre><p>每一轮迭代开始时, 对于任意数组下标 <code>k</code>, 有:</p>
<ol>
<li><code>p &lt;= k &lt;= i, A[k] &lt;= x</code></li>
<li><code>i + 1 &lt;= k &lt;= j - 1, A[k] &gt; x</code></li>
<li><code>k = r, A[k] = x</code></li>
</ol>
<h2 id="性能">性能</h2><p>快速排序的性能依赖于数组是否被平衡的划分, 如果平衡, 那么快速排序的划分是<strong>平衡</strong>的. 那么快速排序的性能与归并排序相同, 否则, 划分是<strong>不平衡</strong>的, 快速排序的性能就接近于插入排序.</p>
<h3 id="最坏情况下的性能">最坏情况下的性能</h3><p>当快速排序在最坏情况下时, 我们获得一个递归式:</p>
<blockquote>
<p>T(n) = T(n-1) + Θ(n)</p>
</blockquote>
<p>得到最坏情况下的时间复杂度仍然为 <code>Θ(n^2)</code>, 而插入排序在最坏情况下时间复杂度也为 <code>Θ(n^2)</code>, 而在几乎有序的情况下快速排序的时间复杂度也为 <code>Θ(n^2)</code>, 插入排序则为 <code>Θ(n)</code>.</p>
<h3 id="最好情况下性能">最好情况下性能</h3><p>在最好的情况下, 每次划分都是平均的, 递归式为:</p>
<blockquote>
<p>T(n) = 2T(n/2) + Θ(n)</p>
</blockquote>
<p>最好的情况下的时间复杂度为 <code>Θ(nlgn)</code>, 我们得到了一个渐进时间最快的算法.</p>
<h3 id="平衡的划分">平衡的划分</h3><p>假设划分算法总是产生 9:1 的划分, 那么递归式为:</p>
<blockquote>
<p> T(n) = T(n/10) + T(9n/10) + cn</p>
</blockquote>
<p>我们在这里求得快速排序的总时间代价依然为 <code>Ο(nlgn)</code>, 由此可以发现, 任何一种<strong>常数</strong>比例的划分都会产生时间复杂度为 <code>Ο(nlgn)</code> 的算法.</p>
<h3 id="随机版本的快速排序">随机版本的快速排序</h3><p>因为快速排序的时间复杂度取决于数组的划分, 有时, 我们希望引入随机性来改善算法的性能. 在这里我们可以采用一种随机抽样的方式选择数组的主元, 达到随机的目的.</p>
<pre><code><span class="function"><span class="keyword">int</span> <span class="title">randomized_partition</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> p, <span class="keyword">int</span> r)</span> </span>{
    <span class="keyword">int</span> i = i = rand() % (r - p) + p;
    EXCHANGE(A[r], A[i])    ;
    <span class="function"><span class="keyword">return</span> <span class="title">partition</span><span class="params">(A, p, r)</span></span>;
}

<span class="function"><span class="keyword">int</span> <span class="title">randomized_quicksort</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> p, <span class="keyword">int</span> r)</span> </span>{
    <span class="keyword">if</span> (p &lt; r - <span class="number">1</span>) {
        <span class="keyword">int</span> q = randomized_partition(A, p, r);
        randomized_quicksort(A, p, q - <span class="number">1</span>);
        randomized_quicksort(A, q + <span class="number">1</span>, r);
    }
}
</code></pre><p>我们只需要在调用 <code>partition</code> 之前随机选择一个 pivot 然后与 <code>A[r]</code> 交换即可.</p>
<h3 id="Hoare版本的快速排序">Hoare版本的快速排序</h3><p>我们在之前使用的 <code>partition</code> 并不是快速排序算法最初的版本, 下面给出的是快速排序最初的版本.</p>
<pre><code><span class="function"><span class="keyword">int</span> <span class="title">hoare_partition</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> p, <span class="keyword">int</span> r)</span> </span>{
    <span class="keyword">int</span> x = A[p],
         i = p - <span class="number">1</span>,
         j = r + <span class="number">1</span>;
    <span class="keyword">while</span> (<span class="keyword">true</span>) {
        <span class="keyword">do</span> { j--; } <span class="keyword">while</span> (!(A[i] &lt;= x));
        <span class="keyword">do</span> { i++; } <span class="keyword">while</span> (!(A[j] &gt;= x));
        <span class="keyword">if</span> (i &lt; j) {
            EXCHANGE(A[i], A[j]);
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> k;
        }
    }
}

<span class="function"><span class="keyword">int</span> <span class="title">hoare_quicksort</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> p, <span class="keyword">int</span> r)</span> </span>{
    <span class="keyword">if</span> (p &lt; r - <span class="number">1</span>) {
        <span class="keyword">int</span> q = hoare_partition(A, p, r);
        hoare_quicksort(A, p, q - <span class="number">1</span>);
        hoare_quicksort(A, q + <span class="number">1</span>, r);
    }
}
</code></pre><h3 id="针对相同元素的快速排序">针对相同元素的快速排序</h3><pre><code>typedef struct {
    <span class="type">int</span> q;
    <span class="type">int</span> t;
} pivot_t;

pivot_t partition(<span class="type">int</span> A[], <span class="type">int</span> p, <span class="type">int</span> r) {
    <span class="type">int</span> x = A[r - <span class="number">1</span>],
        q = p,
        t,
        tmp;

    <span class="keyword">for</span> (<span class="type">int</span> i = p; i &lt; r - <span class="number">1</span>; i++) {
        <span class="keyword">if</span> (A[i] &lt; x) {
            <span class="type">EXCHANGE</span>(A[q], A[i]);
            q++;
        }
    }

    <span class="keyword">for</span> (t = q; t &lt; r &amp;&amp; A[t] == x; t++);

    <span class="keyword">for</span> (<span class="type">int</span> i = r - <span class="number">1</span>; i &gt;= t; i--) {
        <span class="keyword">if</span> (A[i] == x) {
            <span class="type">EXCHANGE</span>(A[t], A[i]);
            t++;
        }
    }

    pivot_t <span class="literal">result</span> = {q, t};
    <span class="keyword">return</span> <span class="literal">result</span>;
}
</code></pre><p><code>partition</code> 过程在这一版本中, 返回 <code>q</code> 和 <code>t</code>, 使得 </p>
<ul>
<li><code>A[p..q-1]</code> 中的每个元素都小于 <code>A[q]</code>.</li>
<li><code>A[q..t]</code> 中的每个元素都等于 <code>A[q]</code>.</li>
<li><code>A[t+1..r]</code> 中的每个元素都大于 <code>A[q]</code>.</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法导论/">算法导论</a>►<a class="article-category-link" href="/categories/算法导论/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/20/Stateful-Collections/" title="Stateful Collections" itemprop="url">Stateful Collections</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-20T15:51:23.000Z" itemprop="datePublished"> 發表於 2015-03-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>There are different kinds of collection depending on what operations are provided. We discuss in two axises about collections.</p>
<ol>
<li>Indexed collections and unindexed collections, depending on whether or not thereis rapid access to individual elements.</li>
<li>Extensible or inextensible collections, depending on whether the number of elements is variable or fixed.</li>
</ol>
<h2 id="Indexed_Collections">Indexed Collections</h2><p>The stateful versions of <strong>tuples</strong> and <strong>records</strong> are <strong>arrays</strong> and <strong>dictionaries</strong>. And now, we have four different kinds of indexed collections.</p>
<p><img src="http://deltax.qiniudn.com/Stateful%20Collections1.png?attname=&amp;e=1426994526&amp;token=YJb_IPQrTSw1ox9LenQDH1HRcgHii9w_bp9ddmcz:UnC-uFe4--jbxOxg76kR83rvZB4" alt="Indexes Collections"></p>
<h3 id="Arrays">Arrays</h3><p>An array is a mapping from integers to partial values. </p>
<ul>
<li>The domain is a set of consecutive integers from lower bound to an upper bound.</li>
<li>The domain is givenwhen the array is declared and cannot be changed afterward.</li>
<li>The range of the mapping can be changed.</li>
<li>Both accessing and changing an array element are done in constant time.</li>
</ul>
<p>There is a strong relationship between tuples and arrays, each of them are mapping from integers to partial values. <strong>But tuples are stateless and arrays are stateful.</strong> And the content of arrays can be changed but tuples can not.</p>
<h3 id="Dictionaries">Dictionaries</h3><p>A dictionary is a mapping from simple constants to partial values. </p>
<ul>
<li>Both the domain and the range of the range of mapping can be changes.</li>
<li>Accessing and changing are done in constant time and adding/removal are done in amortized constant time.</li>
<li>There are no limits to the number of fields in the mapping.</li>
</ul>
<p>There is a close relationship between records and dictionaries. Each of them maps simple contants to partial values. <strong>But records and stateless and dictionaries and stateful.</strong> A records has a fixed set of field but dictionary not.</p>
<h3 id="Choosing_Indexed_Collections">Choosing Indexed Collections</h3><p>The different has different trade-offs in possible operations, memory use, and execution time.</p>
<p>Let us compare the four collections mention above:</p>
<ul>
<li>Tuples<ul>
<li>Most restrictive</li>
<li>Fastest</li>
<li>Require less memory</li>
<li>Stored consecutively</li>
<li>Indexed by number</li>
</ul>
</li>
<li>Records<ul>
<li>More flexible then tuples</li>
<li>Indecies can te literal</li>
<li>Efficient</li>
<li>Stored consecutively</li>
</ul>
</li>
<li>Arrays<ul>
<li>Field can be changed</li>
<li>Bounds can not be changes</li>
<li>Stored consecutively</li>
<li>Efficient</li>
<li>Indexed by number</li>
</ul>
</li>
<li>Dictionaries<ul>
<li>Most general</li>
<li>Indecies can te literal</li>
<li>Created empty</li>
<li>Efficient</li>
<li>More memory and alower access (by a constant factor)</li>
</ul>
</li>
</ul>
<p>We can choose the proper collection type when we use.</p>
<h2 id="Unindexed_Collections">Unindexed Collections</h2><p>Indexed collection are not always the best choice. Sometimes it is better to use unindexed collections, such as lists and streams.</p>
<p>Both of them are declrative data types that collect elements in a linear sqeuence can be traversed from front to back. Any number of traversals can beb done simulataneously on the same list or stream.</p>
<h3 id="Lists">Lists</h3><p>Lists are of finite, fixed length. They are one of the most important data struture in functional programming language. It is really an elegant data struture. And we use <code>map</code> <code>filter</code> <code>fold</code> and many powerful operation to deal with it.</p>
<h3 id="Streams">Streams</h3><p>Streams are also called incomplete lists or partial lists. Their tail are unbound variables. </p>
<ul>
<li>Stream is one of the most efficient extensible collections.</li>
<li>Stream is useful for representing orered sequences of message.</li>
</ul>
<h2 id="Extensible_Collections">Extensible Collections</h2><p>Final, I will introduce some extensible collections, streams, dictionaries and extensible arrays.</p>
<h3 id="Extensible_Arrays">Extensible Arrays</h3><p>As we mentioned above, array is a bounded data structure. How do extensible array work? </p>
<ul>
<li>When the array is full, we create a new array with double size of the older one. And copy all the elements from old one to new one. </li>
<li>When the array is quarter full, we create a new array with half size of the older one. And copy the elements.</li>
</ul>
<p>This data structure take constant time to the cost of resize operation. The most important thing is to ensure that the index must always remain in bound.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/FP/">FP</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/FP/">FP</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/20/Incredible Functional Programming/" title="Incredible Functional Programming" itemprop="url">Incredible Functional Programming</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-19T16:40:16.000Z" itemprop="datePublished"> 發表於 2015-03-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Experience">Experience</h2><p>这一次我为大家分享的主题是, <code>Incredible Functional Programming</code>. 分享的主要的内容是<strong>函数式编程</strong>的一些非常基础的东西, 这与我们平时所使用的<strong>面向对象编程</strong>这种编程范式有着极大的不同. 也希望能给今天的各位带来一些收获或者启发, 而我也能为 <code>Function Programming</code> 的传播与壮大做出自己的一份贡献.</p>
<h3 id="Encounter_Functinol_Programming">Encounter Functinol Programming</h3><p>首先呢, 我想说一下我是如何接触到函数式编程这一编程范式的, 在大一下学期的时候, 有几位 Thoughtworks 的工程师, 来为我们讲解如何使用 Rails 建站. 我个人对这几位工程师也是非常的尊敬的, 在一次偶然的交流中, 他多次提出 Functional Programming 这一编程范式, 当时我对它的第一感觉是很好奇, 而且哪位工程师说过一句话, 我只能记住大概的意思:</p>
<blockquote>
<p>OOP 现在也被很多人批评, 未来一定是 FP 的天下.</p>
</blockquote>
<p>这对于当时只用 Ojective-C 的我来说是不可想象的, 也极大地激起了我的兴趣, 不过, 这件事情虽然没有让我直接转投 FP 的怀抱但是, 我也对 FP 有了很深的印象, 我想: 我就是那时被传教的吧, 也让我之后陷入了这个大坑中.</p>
<p>在之后的学习中, 我学习了<br><a href="http://www.amazon.cn/%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6-%E7%A1%85%E8%B0%B7%E5%88%9B%E4%B8%9A%E4%B9%8B%E7%88%B6Paul-Graham%E6%96%87%E9%9B%86-Paul-Graham/dp/B004WHZGZQ/ref=sr_1_4?ie=UTF8&amp;qid=1426784128&amp;sr=8-4&amp;keywords=%E9%BB%91%E5%AE%A2" target="_blank" rel="external">黑客与画家</a><br>这本书, 书中提到了对 <a href="http://zh.wikipedia.org/wiki/LISP" target="_blank" rel="external">Lisp</a> (Lisp 是第一个函数式编程语言, 其名称源自列表处理器（英语：List Processor）的缩写) 的推崇, 以及他们使用 Lisp 进行开发的效率是当时其他公司的几十倍, 这对于当时使用 OOP 的我是一种巨大的震撼.</p>
<p>EXTREMLY INCREDIBLE!</p>
<h3 id="Learn_Functional_Programming">Learn Functional Programming</h3><p>随着我对 Lisp 的了解, 我也开始学习 Lisp 的方言, 也就是 Scheme. 当时看的书呢, 也是倍受推崇的 SICP(计算机程序的构造和解释), 这也是到目前为止对我影响最大的书, 第一次颠覆了我对编程这项活动的认识, 而我也感觉到了 Lisp 的神奇, 而我们 Programmer 实际上就是魔术师. 我们使用代码当做我们的咒语, 控制着计算机做出各种神奇的事情. </p>
<p>而在学习 Lisp 之后, 我有参加了 Coursera 中的一门公开课, Programming Language, 在这门课中, 我学习了 <a href="http://zh.wikipedia.org/wiki/ML%E8%AF%AD%E8%A8%80" target="_blank" rel="external">Standerd ML</a>, 而且学习了各种各样的编程范式和编程语言 Ruby SML Racket, 以及它们的区别和联系, 而且写了人生中第二个解释器. 这门课也是我在 Coursera 唯一一门从头追到尾并且完成的课程. 感觉跟下来收获还是非常大的.</p>
<p>之后在几个月前, 我又开始学习了 <a href="http://zh.wikipedia.org/wiki/Haskell" target="_blank" rel="external">Haskell</a>, 了解了 Haskell 这门语言的抽象能力是多么的强大, 多么的难学, 概念多么的难以理解, 不过我还是选择学习 Haskell 这门编程语言, 而我学习的最大理由就是他太好玩了, 在 Learn you a Haskell for Great Good 这本书中的前言写到:</p>
<blockquote>
<p>Haskell 很有趣, 这就够了.</p>
</blockquote>
<p>然后就是在 <a href="https://www.hackerrank.com/domains/fp" target="_blank" rel="external">HackerRank</a> 上隔三差五刷两道题解解闷, 顺便陶冶一下情操. 后来我有接触到了 <a href="http://zh.wikipedia.org/wiki/Scala" target="_blank" rel="external">Scala</a>, 不过看着那个丑陋的 IDE 和字体我果断放弃了. 目前就是闲来无事刷刷题, 看看博客, 读读论文. 这基本上就是我到目前为止学习函数式编程的全部经历了.</p>
<hr>
<h2 id="Why_Functional_Programming">Why Functional Programming</h2><p>函数式编程有哪些好处, 我们为什么要学习函数式编程呢.</p>
<ul>
<li>首先, 它很有趣, 这也是我学习函数式编程的原因</li>
<li>其次, 函数在函数式编程中作为一等公民, 提供了强大的抽象能力.  <code>map</code> <code>fold</code> <code>filter</code> 等等操作处理数据非常的优雅. 传统的编程语言都在想方设法集成这些特性.</li>
<li>由于函数式编程中的数据不可改变, 线程竞争在函数式编程是不可能的事情, 这也就能够大大地提高并发编程的处理速度. </li>
<li>同时, 在纯函数式编程语言中, 函数没有任何副作用. 因为函数的返回结果只与输入结果有关, 所以它的稳定性是面向对象编程所不能比的. 因为所有的函数, 都不会依赖于外部的状态, 只取决于输入的参数.</li>
</ul>
<p>随着人们对函数式编程的认识越来越高, 许多公司也开始重视函数式编程在高并发以及稳定性方面的强大能力. </p>
<hr>
<h2 id="Introduction">Introduction</h2><p>接下来, 我介绍一下函数式编程的一些特点和如何学习(入)习(坑), 入坑前请深思熟虑, 我是否能为一个我很少用到的东西投入大量的时间, 换来一些对于个人可以接受的结果.</p>
<p>而对于使用哪一种语言来对函数式编程进行介绍, 我选择了非常简单的 <a href="http://zh.wikipedia.org/wiki/Scheme" target="_blank" rel="external">Scheme</a> 来为各位演示函数式编程, 与我们平时使用的命令式编程有什么区别.</p>
<h3 id="Lambda_Calculus">Lambda Calculus</h3><p>我们在讨论 Scheme 之前, 首先要了解什么是 <a href="http://zh.wikipedia.org/wiki/%CE%9B%E6%BC%94%E7%AE%97" target="_blank" rel="external">lambda演算</a></p>
<blockquote>
<p>λ演算（英语: lambda calculus，λ-calculus）是一套用于研究函数定义、函数应用和递归的形式系统. Lambda 演算可以被称为最小的通用程序设计语言. 它包括一条变换规则（变量替换）和一条函数定义方式, Lambda 演算之通用在于, 任何一个可计算函数都能用这种形式来表达和求值. 因而, 它是等价于图灵机的. 尽管如此, Lambda演算强调的是变换规则的运用,  而非实现它们的具体机器. 可以认为这是一种更接近软件而非硬件的方式.</p>
</blockquote>
<p>我们在接下来的讨论中会提高 lambda 在 Scheme 中如何使用, 所以在这里就先不再多说了.</p>
<h3 id="Church_Number">Church Number</h3><p><a href="http://zh.wikipedia.org/wiki/%E9%82%B1%E5%A5%87%E6%95%B0" target="_blank" rel="external">邱奇数</a> 是把数据和运算符嵌入到 lambda 演算内的一种方式, 它是使用 lambda 符号的自然数表示法.</p>
<pre><code><span class="list">(<span class="keyword"><span class="built_in">define</span></span> zero <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">f</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span> x)</span>)</span>)</span>
<span class="list">(<span class="keyword"><span class="built_in">define</span></span> one <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">f</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span> <span class="list">(<span class="keyword">f</span> x)</span>)</span>)</span>)</span>
<span class="list">(<span class="keyword"><span class="built_in">define</span></span> two <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">f</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span> <span class="list">(<span class="keyword">f</span> <span class="list">(<span class="keyword">f</span> x)</span>)</span>)</span>)</span>)</span>
<span class="list">(<span class="keyword"><span class="built_in">define</span></span> <span class="list">(<span class="keyword">plus</span> n m)</span>
  <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">f</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span> <span class="list">(<span class="list">(<span class="keyword">m</span> f)</span> <span class="list">(<span class="list">(<span class="keyword">n</span> f)</span> x)</span>)</span>)</span>)</span>)</span>

<span class="list">(<span class="keyword"><span class="built_in">define</span></span> true <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">y</span>)</span> x)</span>)</span>)</span>
<span class="list">(<span class="keyword"><span class="built_in">define</span></span> false <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">y</span>)</span> y)</span>)</span>)</span>
</code></pre><p>我在这里只为各位简单的展示一下如何使用 lambda 来表示一些数据类型.</p>
<h3 id="Intrduction_to_Scheme">Intrduction to Scheme</h3><p>Scheme 是一种函数式语言, 是 Lisp 的两种主要的方言之一, 它的设计极其的简单, 一个小型语言核心作为标准, 加上各种强力的语法糖扩展语言本身. Scheme的哲学是: 设计计算机语言不应该进行功能的堆砌, 而应该尽可能减少弱点和限制, 使剩下的功能显得必要. Scheme 是第一个使用静态作用域的 Lisp 方言, 也是第一个引入”干净宏”和第一类续延的编程语言.</p>
<h4 id="Warm_Up">Warm Up</h4><p>我现在介绍一下在 Scheme 中最简单的一些表达式</p>
<pre><code>(+ <span class="number">2</span> <span class="number">5</span>) =&gt; <span class="number">7</span>
(* <span class="number">3</span> <span class="number">5</span> (+ <span class="number">2</span> <span class="number">4</span>)) =&gt; <span class="number">90</span>
</code></pre><p>我们可以看到, 在 Scheme 中所有的表达式都是被采用前序(prefix)表示法, 并且<strong>括号</strong>以及空白作为分隔符.</p>
<pre><code><span class="comment">(define a 1)</span>
<span class="comment">(define b 2)</span>
<span class="comment">(define (double x)</span> <span class="comment">(+ x x)</span>)
<span class="comment">(if (= (double a)</span> <span class="number">2</span>)
    <span class="comment">((lambda (x)</span> <span class="comment">(+ x b)</span>) <span class="number">2</span>)
    <span class="number">0</span>)

=&gt; <span class="number">4</span>
</code></pre><ul>
<li><code>define</code> 不仅可以定义一个变量 <code>(define  a 1)</code>, 也可以定义一个函数 <code>(define (double x) (+ x x))</code>.<ul>
<li><code>(define &lt;identifier&gt; &lt;expression&gt;)</code></li>
</ul>
</li>
<li><code>if</code> 语句的语法如下<ul>
<li><code>(if &lt;predicate-clause&gt; &lt;true-clause&gt; &lt;false-clause&gt;)</code></li>
</ul>
</li>
<li><code>lambda</code> 其实可以看作一个匿名函数, 在这里它接收一个参数 <code>x</code> 返回一个单参数的函数, 然后把 <code>2</code> 作为这个函数的参数返回 <code>(+ 2 b) =&gt; 4</code>.<ul>
<li><code>(lambda (parameters) expression)</code></li>
</ul>
</li>
</ul>
<p>而到目前为止, 我们已经掌握了这次分享与 Scheme 有关的全部语法了.</p>
<h4 id="Newton’s_Method">Newton’s Method</h4><p>不论你学习哪一种函数式编程语言, <strong>牛顿法</strong> (Newton’s method)求平方跟都是一个你基本扰不过的问题, 因为我在很多函数式编程语言的书或者课程中, 都发现了他的身影, 包括 Scala Haskell Scheme …</p>
<p>牛顿法怎么求某个 <code>x</code> 的平方根呢.</p>
<ol>
<li>做出一个猜测 <code>guess</code>.</li>
<li>求出 <code>guess</code> 的平方, 然后与 <code>x</code> 比较, 如果差值在可以容忍的范围之内, 那么 <code>guess</code> 就是我们要求的近似的平方根, 如果不满足, 则继续步骤 3.</li>
<li>求出 <code>x/guess</code> 的值, 并与 <code>guess</code> 求平均数, 提高 <code>guess</code> 的准确性, 返回步骤 2.</li>
</ol>
<p>代码如下:</p>
<pre><code><span class="list">(<span class="keyword"><span class="built_in">define</span></span> <span class="list">(<span class="keyword"><span class="built_in">sqrt</span></span> x)</span>
  <span class="list">(<span class="keyword"><span class="built_in">define</span></span> <span class="list">(<span class="keyword">good-enough?</span> guess)</span>
    <span class="list">(<span class="keyword"><span class="built_in">&lt;</span></span> <span class="list">(<span class="keyword"><span class="built_in">abs</span></span> <span class="list">(<span class="keyword"><span class="built_in">-</span></span> <span class="list">(<span class="keyword">square</span> guess)</span> x)</span>)</span> tolerance)</span>)</span>
  <span class="list">(<span class="keyword"><span class="built_in">define</span></span> <span class="list">(<span class="keyword">improve</span> guess)</span>
    <span class="list">(<span class="keyword">average</span> guess <span class="list">(<span class="keyword"><span class="built_in">/</span></span> x guess)</span>)</span>)</span>
  <span class="list">(<span class="keyword"><span class="built_in">define</span></span> <span class="list">(<span class="keyword">sqrt-iter</span> guess)</span>
    <span class="list">(<span class="keyword"><span class="built_in">if</span></span> <span class="list">(<span class="keyword">good-enough?</span> guess)</span>
        guess
        <span class="list">(<span class="keyword">sqrt-iter</span> <span class="list">(<span class="keyword">improve</span> guess)</span>)</span>)</span>)</span>
  <span class="list">(<span class="keyword"><span class="built_in">define</span></span> tolerance <span class="number">0.001</span>)</span>
  <span class="list">(<span class="keyword">sqrt-iter</span> <span class="number">1.0</span>)</span>)</span>
</code></pre><p>这段代码使用了非常神奇的方式, 迭代地解决了如何使求平方根的问题, 我觉得在此处用作例子也再好不过, 我们整理一下这段代码, 让你们感觉到函数式编程的神奇和它带给我们的强大的表达能力.</p>
<h3 id="Introduction_to_Haskell">Introduction to Haskell</h3><p>接下来我们将使用 Haskell 继续对函数式编程进行介绍. 我们接下来将介绍一下几个概念:</p>
<ul>
<li>列表(和列表推导式)</li>
<li>模式匹配</li>
<li>柯里化</li>
</ul>
<p>这三个重要的概念都是在函数编程中极其常用的, 如果你选择了函数式编程, 那么几乎每时每刻都在与这三者打交道.</p>
<h4 id="Warm_Up-1">Warm Up</h4><p>我们先来写几个非常简单的 Haskell 函数来热一热身, 我们先把之前 使用 Scheme 求平方根的代码, 转换为 Haskell 编译器能够理解的 Haskell 代码.</p>
<pre><code>sqrt :: (Ord s, Floating s) =&gt; s -&gt; s
sqrt <span class="variable">x =</span> sqrtIter <span class="number">1.0</span>
  where <span class="variable">tolerance =</span> <span class="number">0.0001</span>
        goodEnough <span class="variable">guess =</span> abs ((guess ** <span class="number">2</span>) - x) &lt; tolerance
        improve <span class="variable">guess =</span> (guess + x / guess) / <span class="number">2</span>
        sqrtIter <span class="variable">guess =</span> <span class="keyword">if</span> goodEnough guess
                         <span class="keyword">then</span> guess
                         <span class="keyword">else</span> sqrtIter $ improve guess
</code></pre><p>在 Haskell 中为函数加上类型声明是非常好的习惯, 这里的类型声明暂时不需要大家理解.</p>
<pre><code><span class="keyword">double</span> :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
<span class="keyword">double</span> x = x * <span class="number">2</span>

square :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
square x = x * x
</code></pre><p>这里我们可以看到两个函数的类型声明都是 <code>Int -&gt; Int</code> 就是接收一个 <code>Int</code> 类型的值, 返回一个 <code>Int</code> 类型的值.</p>
<h4 id="List_and_List_Comprehension">List and List Comprehension</h4><p>在Haskell中, List 非常的重要. 它是最常用的数据结构，并且十分强大，灵活地使用它可以解决很多问题. 它是一种单类型的数据结构, 可以用来存储多个类型相同的元素. 我们可以在里面装一组数字或者一组字符, 但不能把字符和数字装在一起, 而且 List 是可以嵌套的.</p>
<pre><code>ghci&gt; let numbers = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]
ghci&gt; numbers
[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]

ghci&gt; let nestedNumbers = <span class="string">[[1,2,3,4],[5,3,3,3],[1,2,2,3,4],[1,2,3]]</span>   
ghci&gt; nestedNumbers
<span class="string">[[1,2,3,4],[5,3,3,3],[1,2,2,3,4],[1,2,3]]</span>   

ghci&gt; <span class="number">3</span>:[head numbers] ++ [head $ tail numbers]
[<span class="number">4</span>,<span class="number">5</span>]
</code></pre><ul>
<li>我们使用 head tail ++ : 几种对列表进行简单的处理.<ul>
<li>head 取出列表中第一个元素</li>
<li>tail 取出列表去掉第一个元素后剩下的列表</li>
<li>++ 连接两个列表</li>
<li>: 在列表前添加一个元素</li>
</ul>
</li>
</ul>
<p>至于一些其他的方法, 在这里也不做过多的介绍, 比如说 <code>length</code> <code>reverse</code> <code>take</code> … 他们都是非常重要的操作.</p>
<p>如果你现在还记得对集合的 Comprehension 那么, 你对 Haskell 的 List Comprehension 理解也会十分的轻松.</p>
<pre><code><span class="title">ghci</span>&gt; [x*<span class="number">2</span> | x &lt;- [<span class="number">1.</span><span class="number">.10</span>]]   
[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">16</span>,<span class="number">18</span>,<span class="number">20</span>]

<span class="title">ghci</span>&gt; [x*<span class="number">2</span> | x &lt;- [<span class="number">1.</span><span class="number">.10</span>], x*<span class="number">2</span> &gt;= <span class="number">12</span>]   
[<span class="number">12</span>,<span class="number">14</span>,<span class="number">16</span>,<span class="number">18</span>,<span class="number">20</span>] 

<span class="title">ghci</span>&gt; [ x | x &lt;- [<span class="number">50.</span><span class="number">.100</span>], x `mod` <span class="number">7</span> == <span class="number">3</span>]   
[<span class="number">52</span>,<span class="number">59</span>,<span class="number">66</span>,<span class="number">73</span>,<span class="number">80</span>,<span class="number">87</span>,<span class="number">94</span>]

<span class="title">ghci</span>&gt; [ x*y | x &lt;- [<span class="number">2</span>,<span class="number">5</span>,<span class="number">10</span>], y &lt;- [<span class="number">8</span>,<span class="number">10</span>,<span class="number">11</span>]]   
[<span class="number">16</span>,<span class="number">20</span>,<span class="number">22</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">55</span>,<span class="number">80</span>,<span class="number">100</span>,<span class="number">110</span>]
</code></pre><p>这里也没啥好说的, 太简单了.</p>
<p>我们使用列表推倒来实现 quicksort.</p>
<pre><code>quicksort :: [Int] -&gt; [Int]
quicksort [] = []
quicksort (x:xs) = quicksort <span class="keyword">ls</span> ++ [x] ++ quicksort <span class="keyword">bs</span>
  where <span class="keyword">ls</span> = [<span class="keyword">l</span> | <span class="keyword">l</span> &lt;- xs, <span class="keyword">l</span> &lt;= x]
        <span class="keyword">bs</span> = [b | b &lt;- xs, b &gt; x]
</code></pre><h4 id="Pattern_Matching">Pattern Matching</h4><p>模式匹配通过检查数据的特定结构来检查其是否匹配, 并按模式从中取得数据. 举一个例子大家就能非常轻松地理解模式匹配.</p>
<pre><code><span class="label">factorial ::</span> (Integral <span class="literal">a</span>) =&gt; <span class="literal">a</span> -&gt; <span class="literal">a</span>   
factorial <span class="number">0</span> = <span class="number">1</span>   
factorial n = n * factorial (n - <span class="number">1</span>)  
</code></pre><p><code>factorial</code> 是一个递归的函数, <code>factorial</code> 接收一个参数, 当这个参数为 0 的时候, 会匹配到第一种情况直接返回 1, 否则就会匹配到第二种情况, 递归地求解 <code>factorial</code>, 直到参数为 0, 返回结果.</p>
<p>这个函数可以等价为</p>
<pre><code><span class="label">factorial ::</span> (Integral <span class="literal">a</span>) =&gt; <span class="literal">a</span> -&gt; <span class="literal">a</span>
factorial n = <span class="keyword">if</span> n == <span class="number">0</span> then <span class="number">1</span> <span class="keyword">else</span> n * factorial (n - <span class="number">1</span>)
</code></pre><p>不过使用模式匹配的写法对于使用函数式编程的人来说更加具有可读性, 而经过长时间的使用, 相信各位一定会习惯模式匹配的写法.</p>
<p>有很多命令式语言都提供 <code>case</code> 表达式, 就是取一个变量, 按照对变量的判断选择对应的代码块, 而模式匹配实际上就是 <code>case</code> 表达式的语法糖.</p>
<pre><code><span class="keyword">case</span> expression <span class="keyword">of</span> pattern -&gt; <span class="literal">result</span>   
                   pattern -&gt; <span class="literal">result</span>   
                   pattern -&gt; <span class="literal">result</span> 
</code></pre><p>我们将阶乘函数转化为 <code>case</code> 形式:</p>
<pre><code>factorial :: (<span class="type">Integral</span> a) =&gt; a -&gt; a   
factorial n = <span class="keyword">case</span> n <span class="keyword">of</span> <span class="number">0</span> -&gt; <span class="number">1</span>
                                 n -&gt; n * factorial (n-<span class="number">1</span>)
</code></pre><p>好了, 我们已经对模式匹配有了了解, 接下来我们该介绍函数式编程下一个非常有趣的话题.</p>
<h4 id="Currying">Currying</h4><p><a href="http://zh.wikipedia.org/wiki/%E6%9F%AF%E9%87%8C%E5%8C%96" target="_blank" rel="external">柯里化</a> 是把接收多个参数的函数变换成接收一个单一参数的函数.</p>
<p>比如我们定义一个函数 <code>add</code>:</p>
<pre><code><span class="keyword">add</span> :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
</code></pre><p>在之前的理解中, <code>add</code> 是一个接收两个 <code>Int</code> 类型参数的并返回一个 <code>Int</code> 的函数.</p>
<pre><code><span class="keyword">add</span> <span class="built_in">x</span> <span class="built_in">y</span> = <span class="built_in">x</span> + <span class="built_in">y</span>
</code></pre><p>我们直接将两个参数传入这个函数 <code>add 3 4</code> 就会返回 <code>5</code>.</p>
<p>但是, 现在我们能不能只给他传一个参数呢, 我么来尝试一下:</p>
<pre><code>ghci&gt;<span class="instruction"> add </span>3

&lt;interactive&gt;:9:1:
    No<span class="instruction"> instance </span>for<span class="function"> (</span>Show<span class="function"> (</span>a0 -&gt; a0<span class="function">)</span><span class="function">)</span> arising from a use of ‘print’
    In a stmt of an interactive GHCi command: print it
</code></pre><p>我们直接在 ghci 中输入 <code>add 3</code> 然后, 编译器报错了, 错误的内容是不能正确的显示这个结果, 说明编译器不理解如何 <code>print</code> 这个结果, 我们换一种方式查看一下类型:</p>
<pre><code>ghci&gt; :t <span class="keyword">add</span> <span class="number">3</span>
<span class="keyword">add</span> <span class="number">3</span> :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
</code></pre><p>发现这个 <code>add 3</code> 的类型竟然是 <code>Int -&gt; Int</code> 这说明, <code>add</code> 函数接受了一个 <code>Int</code> 返回了一个 <code>Int -&gt; Int</code> 的函数.</p>
<p>我们接下来为这个函数起一个名字</p>
<pre><code>ghci&gt; let addThree = <span class="keyword">add</span> <span class="number">3</span>
ghci&gt; :t <span class="keyword">add</span>
<span class="keyword">add</span>       addThree
ghci&gt; :t addThree
addThree :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
</code></pre><p>然后尝试调用这个函数</p>
<pre><code>ghci&gt; addThree 4
7
</code></pre><p>发现这个函数的返回值竟然也是 <code>7</code> 这是为什么呢?</p>
<p>因为在函数式语言的实现中, 函数的定义会被转换为如下的形式:</p>
<pre><code>add :: Int<span class="function"> -&gt;</span> Int<span class="function"> -&gt;</span> Int
add = <span class="string">\x</span> <span class="function">-&gt;</span> (<span class="string">\y</span> <span class="function">-&gt;</span> x + y)
</code></pre><p>它可以每次只接受一个参数, 然后返回一个函数或者值. 这就是函数为什么可以柯里化的原因.</p>
<p>柯里化又可以做些什么呢, 我们在介绍一个非常重要的函数 <code>map</code>, <code>map</code> 翻译过来就是映射, 他把一个函数映射到一个列表中, 我们简单的举个例子.</p>
<pre><code><span class="tag">ghci</span>&gt; <span class="tag">map</span> (\<span class="tag">x</span> <span class="tag">-</span>&gt; <span class="tag">x</span> * <span class="tag">x</span>) <span class="attr_selector">[1,2,3,4,5]</span>
<span class="attr_selector">[1,4,9,16,25]</span>    
</code></pre><p>它把一个匿名函数依次映射到列表 <code>[1,2,3,4,5]</code> 中, 最后将这些结果连接成一个列表.</p>
<p><code>map</code> 为我们提供了一个高阶的抽象, 它以一个函数和列表作为参数, 返回一个列表.</p>
<pre><code>map :: <span class="function"><span class="params">(a -&gt; b)</span> -&gt;</span> [a]<span class="function"> -&gt;</span> [b]
</code></pre><p>我们接下来就可以使用 <code>map</code> 和柯里化构建大量的函数, 减少我们的工作量</p>
<pre><code>square :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
square = \x -&gt; x * x

<span class="keyword">double</span> :: <span class="keyword">Int</span> -&gt; <span class="keyword">Int</span>
<span class="keyword">double</span> = (+<span class="number">2</span>)

squareList :: [<span class="keyword">Int</span>] -&gt; [<span class="keyword">Int</span>]
squareList = map square

doubleList :: [<span class="keyword">Int</span>] -&gt; [<span class="keyword">Int</span>]
doubleList = map <span class="keyword">double</span>
</code></pre><p>而接下来我们就可以直接使用 <code>squareList</code> 和 <code>doubleList</code> 完成对列表的操作.</p>
<hr>
<h2 id="Application">Application</h2><p>目前应用到生产环境还是比较少, 不过已经有一些公司, 使用 scala, Erlang 等等语言做一些后端方面的开发. 我对这些语言的了解还是比较少的.</p>
<p>Lisp 也被用来开发 Emacs 和一些人工智能的领域, 具体戳这里<a href="http://en.wikipedia.org/wiki/Common_Lisp#Applications" target="_blank" rel="external">http://en.wikipedia.org/wiki/Common_Lisp#Applications</a>.</p>
<p>当你理解了函数式编程的一些思想, 你会发现原来以前所学过的很多东西都是函数式编程的缩影, 而对于 iOS 开发, 目前是十分流行的框架 <code>ReactiveCocoa</code> 就是由函数式编程的思想开发的.</p>
<hr>
<h2 id="Final">Final</h2><p>最后的最后, 我为大家推荐一些函数式编程的学习资料.</p>
<p>Scheme:</p>
<ul>
<li><a href="http://www.amazon.cn/The-Little-Schemer-Friedman-Daniel-P/dp/0262560992/ref=sr_1_1?ie=UTF8&amp;qid=1426822097&amp;sr=8-1&amp;keywords=the+little+schemer" target="_blank" rel="external">The Litter Schemer</a></li>
<li><a href="http://www.amazon.cn/Structure-and-Interpretation-of-Computer-Programs-Abelson-Harold/dp/0262510871/ref=sr_1_2?ie=UTF8&amp;qid=1426822081&amp;sr=8-2&amp;keywords=Structure+and+Interpretation+of+Computer+Program" target="_blank" rel="external">Structure and Interpretation of Computer Program</a></li>
<li><a href="http://mitpress.mit.edu/sicp/" target="_blank" rel="external">http://mitpress.mit.edu/sicp/</a></li>
</ul>
<p>Haskell:</p>
<ul>
<li><a href="http://learnyouahaskell.com/" target="_blank" rel="external">Learn you a haskell for great good</a></li>
<li><a href="http://book.realworldhaskell.org/read/" target="_blank" rel="external">Real World Haskell</a></li>
</ul>
<p>终于结束了…真累.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/FP/">FP</a>►<a class="article-category-link" href="/categories/FP/Scheme/">Scheme</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/FP/">FP</a><a href="/tags/Scheme/">Scheme</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/19/堆排序/" title="堆排序" itemprop="url">堆排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-19T07:06:47.000Z" itemprop="datePublished"> 發表於 2015-03-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>一种时间复杂度为 <code>Ο(nlgn)</code> 的排序算法.</p>
<h2 id="堆">堆</h2><p><code>二叉堆</code> 是一个数组, 它可以被看成一个近似的完全二叉树, 除了最底层外, 该树是完全充满的, 而且是从左向右填充.</p>
<pre><code><span class="function"><span class="keyword">int</span> <span class="title">parent</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{
    <span class="keyword">return</span> i / <span class="number">2</span>;
}

<span class="function"><span class="keyword">int</span> <span class="title">left</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{
    <span class="keyword">return</span> <span class="number">2</span> * i;
}

<span class="function"><span class="keyword">int</span> <span class="title">right</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{
    <span class="keyword">return</span> <span class="number">2</span> * i + <span class="number">1</span>;
}
</code></pre><p>二叉堆分两种形式: 最大堆和最小堆. 在这两种堆中, 结点的值都要满足堆的性质.</p>
<ul>
<li>在最大堆中 <code>(max-heap)</code> 中, 除了根以外的所有节点 <code>i</code> 都满足:<ul>
<li><code>A[PARENT.(i)] ≧ A[i]</code></li>
</ul>
</li>
<li>在最小堆 <code>(min-heap)</code> 中, 除了根以外的所有节点 <code>i</code> 都满足:<ul>
<li><code>A[PARENT.(i)] ≦ A[i]</code></li>
</ul>
</li>
</ul>
<p>一般情况下, 我们在堆排序算法中使用<strong>最大堆</strong>, 在构造优先队列中使用<strong>最小堆</strong></p>
<hr>
<h2 id="维护堆的性质">维护堆的性质</h2><p><code>max_heapify</code> 是用于维护最大堆性质的重要过程.</p>
<pre><code>void max_heapify(heap_t *heap, <span class="built_in">int</span> i) {
    <span class="built_in">int</span> largest;
    <span class="built_in">int</span> l = left(i);
    <span class="built_in">int</span> r = right(i);

    <span class="keyword">if</span> (l &lt;= <span class="type">A</span>-&gt;heap_size &amp;&amp; heap-&gt;elements[l] &gt; heap-&gt;elements[i]) {
        largest = l;
    } <span class="keyword">else</span> {
        largest = i;
    }

    <span class="keyword">if</span> (r &lt;= <span class="type">A</span>-&gt;heap_size &amp;&amp; heap-&gt;elements[r] &gt; heap-&gt;elements[i]) {
        largest = r;
    }

    <span class="keyword">if</span> (largest != i) {
        <span class="built_in">int</span> temp = heap-&gt;elements[largest];
        heap-&gt;elements[i] = heap-&gt;elements[largest];
        heap-&gt;elements[largest] = temp
        max_heapify(heap, largest);
    }
}
</code></pre><p>对于一棵以 <code>i</code> 为根节点, 大小为 <code>n</code> 的子树, <code>max_heapify</code> 的时间代价的递归式为:</p>
<pre><code><span class="function"><span class="title">T</span><span class="params">(n)</span></span> ≦ <span class="function"><span class="title">T</span><span class="params">(<span class="number">2</span>n/<span class="number">3</span>)</span></span> + Θ(<span class="number">1</span>) =&gt; <span class="function"><span class="title">T</span><span class="params">(n)</span></span> = Ο(lgn)
</code></pre><hr>
<h2 id="建堆">建堆</h2><p>我们可以使用自底向上的方法利用过程 <code>max_heapify</code> 把一个大小为 <code>n = A.length</code> 的数组 <code>A[1..n]</code> 转换为最大堆.</p>
<pre><code><span class="keyword">void</span> build_max_heap(heap_t *heap) {
    heap-&gt;heap_size = heap-&gt;<span class="built_in">length</span>;
    <span class="keyword">for</span> (<span class="keyword">int</span> i = heap-&gt;<span class="built_in">length</span> / <span class="number">2</span>; i &lt;= <span class="number">1</span>; i--) {
        max_heapify(heap, i)
    }
}
</code></pre><p><code>build_max_heap</code> 的时间复杂度为 <code>Ο(n)</code>.</p>
<hr>
<h2 id="堆排序算法">堆排序算法</h2><p>堆排序算法使用 <code>build_max_heap</code> 将输入的数组 <code>A[0..n-1]</code> 建成最大堆. 数组中的最大元素总在根节点 <code>A[0]</code>, 通过把它与 <code>A[n-1]</code> 进行交换, 我们可以把元素放到正确的位置. 而我们只需要不断的调用 <code>max_heapify</code> 来维护堆的性质——<strong>A[0]为最大元素</strong>, 并把子数组中的最大元素移到合适的位置.</p>
<pre><code>void heapsort(heap_t *heap) {
    build_max_heap(heap);
    <span class="keyword">for</span> (<span class="built_in">int</span> i = heap-&gt;length - <span class="number">1</span>; i &gt;= <span class="number">2</span>; i--) {
        <span class="built_in">int</span> temp = heap-&gt;elements[<span class="number">0</span>];
        heap-&gt;elements[<span class="number">0</span>] = heap-&gt;elements[i];
        heap-&gt;elements[i] = temp;
        heap-&gt;heap_size--;
        max_heapify(heap, <span class="number">1</span>)
    }
}
</code></pre><p><code>heapsort</code> 过程的时间复杂度是 <code>Ο(nlgn)</code> </p>
<hr>
<h2 id="优先队列">优先队列</h2><p><code>优先队列</code> (priority queue)是一种用来维护由一组最大元素构成的集合 S 的数据结构, 其中的每个元素都有一个相关的值, 成为<strong>关键字</strong>. 一个最大优先队列支持以下的操作:</p>
<ul>
<li><code>INSERT(S, x)</code>: 把元素 <code>x</code> 插入集合 <code>S</code> 中, 这一操作等价于 <code>S=S U {x}</code></li>
<li><code>MAXIMUM(S)</code>: 返回 <code>S</code> 中具有最大键字的元素.</li>
<li><code>EXTRACT-MAX(S)</code>: 去掉并返回 <code>S</code> 中的具有最大键字的元素.</li>
<li><code>INCREASE-KEY(S, x, k)</code>: 将元素 <code>x</code> 的关键字值增加到 <code>k</code>, 这里假设 <code>k</code> 的值不小于 <code>x</code> 的原关键字值.</li>
</ul>
<p>优先队列可以使用堆来实现, 我们来实现最大优先队列:</p>
<pre><code><span class="keyword">int</span> heap_maximum(heap_t *heap) {
    <span class="keyword">return</span> heap-&gt;element[<span class="number">0</span>];
}

<span class="keyword">int</span> heap_extract_max(heap_t *heap) {
    <span class="keyword">if</span> (heap-&gt;heap_size &lt; <span class="number">1</span>) {
        fprinrf(stderr, <span class="string">"heap underflow"</span>);
    }
    <span class="keyword">int</span> max = A[<span class="number">0</span>];
    A[<span class="number">0</span>] = A[heap-&gt;heap_size];
    heap-&gt;heap_size--;
    max_heapify(heap, <span class="number">0</span>);
    <span class="keyword">return</span> max;
}

void heap_increase_key(heap_t *heap, <span class="keyword">int</span> i, <span class="keyword">int</span> key) {
    <span class="keyword">if</span> (key &lt; heap-&gt;elements[i]) {
        fprinrf(stderr, <span class="string">"new key is smaller than current key"</span>);
    }
    heap-&gt;elements[i] = key;

    <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; heap-&gt;elements[parent(i)] &lt; A[i]) {
        <span class="keyword">int</span> temp = heap-&gt;elements[i];
        heap-&gt;elements[i] = heap-&gt;elements[parent(i)];
        heap-&gt;elements[parent(i)] = temp;
        i = PARENT(i);
    }
}

void max_heap_insert(heap_t *heap, <span class="keyword">int</span> key) {
    heap-&gt;heap_size++;
    heap-&gt;elements[heap-&gt;heap_size] = INT_MIN;
    heap_increase_key(heap, heap-&gt;heap_size - <span class="number">1</span>, key);
}
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法导论/">算法导论</a>►<a class="article-category-link" href="/categories/算法导论/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/堆/">堆</a><a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/18/Parameter-Passing-Mechanisms/" title="Parameter Passing Mechanisms" itemprop="url">Parameter Passing Mechanisms</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-18T08:47:50.000Z" itemprop="datePublished"> 發表於 2015-03-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>The operation of a data abstraction can have arguments and results. Many different mechanisms have been divised to pass the arguments and results between a calling program and an abstraction.</p>
<h3 id="Call_by_Reference">Call by Reference</h3><p>The identity of a <strong>language entity is passed to the procedure</strong>. The procedure can then use this language entity freely. This is the primitive mechanism used by the computation models of the book for all language entities including dataflow variables and cells.</p>
<h3 id="Call_by_Variable">Call by Variable</h3><p>This is a special case of call by reference. <strong>The identity of a cell is passed to the procedure</strong>.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">Sqr</span> A}
    A:=@A*@A
<span class="keyword">end</span>
local
    C={<span class="type">NewCell</span> <span class="number">0</span>}
<span class="keyword">in</span>
    C:=<span class="number">25</span>
    {<span class="type">Sqr</span> C}
    {<span class="type">Browse</span> @C}
<span class="keyword">end</span>
</code></pre><h3 id="Call_by_Value">Call by Value</h3><p>A value is passed to the procedure and put into a cell local to the procedure.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">Sqr</span> D}
    A={<span class="type">NewCell</span> D}
<span class="keyword">in</span>
    A:=@A+<span class="number">1</span>
    {<span class="type">Browse</span> @A*@A}
<span class="keyword">end</span>
{<span class="type">Sqrt</span> <span class="number">25</span>}
</code></pre><p>The cell a is initialized with the arguement of <code>Sqr</code>.</p>
<h3 id="Call_by_Value-result">Call by Value-result</h3><p>This is a modification of call by variable. When the procedure is called, the content of a cell is put into another mutable variable local to the procedure. When the procedure returns, the content of the latter cell is put into the former cell.</p>
<pre><code>proc <span class="list">{Sqr A}</span>
    <span class="keyword">D</span>=<span class="list">{NewCell @A}</span>
in
    <span class="keyword">D</span>:=@<span class="keyword">D</span>*@<span class="keyword">D</span>
    A:=@<span class="keyword">D</span>
end
local
    <span class="keyword">C</span>=<span class="list">{NewCell 0}</span>
in
    <span class="keyword">C</span>:=<span class="number">25</span>
    <span class="list">{Sqr C}</span>
    <span class="list">{Browse @C}</span>
end
</code></pre><p>When entering the <code>Sqr</code>, <code>D</code> is assigned to the content of <code>A</code>. After computation, assigned the content of <code>D</code> back to the <code>C</code>. And we can reference <code>C</code> from outside.</p>
<h3 id="Call_by_Name">Call by Name</h3><p>This mechanism creates a function to wrap each argument which is called thunk. And each time argument is needed, call it as a function, and this returns an unwrapped argument.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">Sqr</span> A}
    {A}:=@{A}*@{A}
<span class="keyword">end</span>
local C={<span class="type">NewCell</span> <span class="number">0</span>} <span class="keyword">in</span>
    C:=<span class="number">25</span>
    {<span class="type">Sqr</span> fun {$} C <span class="keyword">end</span>}
    {<span class="type">Browse</span> @C}
<span class="keyword">end</span>
</code></pre><p>The function wrapped in thunk is called each time, the argument is needed.</p>
<h3 id="Call_by_Need">Call by Need</h3><p>This is a modification and improve of call by name, which the function is called at most once. When the function is first called, its result stored and used for subsequent evaluations.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">Sqr</span> A}
    B={A}
<span class="keyword">in</span>
    B:=@B*@B
<span class="keyword">end</span>
local C={<span class="type">NewCell</span> <span class="number">0</span>} <span class="keyword">in</span>
    C:=<span class="number">25</span>
    {<span class="type">Sqr</span> fun {$} C <span class="keyword">end</span>}
    {<span class="type">Browse</span> @C}
<span class="keyword">end</span>
</code></pre><p>The argument <code>A</code> is evaluated when it is needed, and after first evaluate, it stored in the variable <code>B</code>, and then every time <code>A</code> is needed, just use <code>B</code> instead.</p>
<p>This approach is exactly the same concept as lazy evalution.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/18/Explicit-State/" title="Explicit State" itemprop="url">Explicit State</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-18T06:34:39.000Z" itemprop="datePublished"> 發表於 2015-03-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="State">State</h2><p>A <code>state</code> is a sequence of values in time that contains the intermediate results of a desired computation.</p>
<p>There are different ways that state can be used in a program.</p>
<ul>
<li>Implicit or declarative state<ul>
<li>The state need only exist in the mind of the programmer. It does not need any support at all from the computation model.</li>
</ul>
</li>
<li><p>Explicit state</p>
<ul>
<li><p>A procedure is a state whose lifetime extends over more than one procedure call without being present in the procedure’s arguments.</p>
<pre><code>local
    C=<span class="comment">{NewCell 0}</span>
<span class="keyword">in</span>
    fun <span class="comment">{SumList Xs S}</span>
        C:=@C+<span class="number">1</span>
        <span class="keyword">case</span> Xs
        <span class="keyword">of</span> <span class="keyword">nil</span> <span class="keyword">then</span> S
        [] X|Xr <span class="keyword">then</span> <span class="comment">{SumList Xr X+S}</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    fun <span class="comment">{SumCount}</span> @C <span class="keyword">end</span>
<span class="keyword">end</span>

% <span class="keyword">In</span> this <span class="function"><span class="keyword">procedure</span>, <span class="title">C</span> <span class="title">is</span> <span class="title">not</span> <span class="title">an</span> <span class="title">arugment</span> <span class="title">for</span> <span class="title">the</span> <span class="title">function</span> <span class="title">SumList</span> <span class="title">and</span> <span class="title">we</span> <span class="title">can</span> <span class="title">use</span> <span class="title">another</span> <span class="title">helper</span> <span class="title">function</span> <span class="title">SumCount</span> <span class="title">to</span> <span class="title">get</span> <span class="title">its</span> <span class="title">value</span>.</span>
</code></pre></li>
<li><p>With explicit state, data abstraction gain tremendously in modularity since is is possible to <strong>encapsulate an explicit state inside a data abstraction</strong>. And the access to state is limited according to the operations of the data abstraction.</p>
</li>
</ul>
</li>
</ul>
<h2 id="Data_Abstraction">Data Abstraction</h2><p><strong>Data abstraction</strong> is a way of using data in abstract fashion, we can use the data without having to deal with its implementation. It contains a set of instances that can be used according to certain rules called interface.</p>
<h3 id="Organize_Data_Abstraction">Organize Data Abstraction</h3><ul>
<li><code>Openness and Security</code><ul>
<li>A data abstraction is <code>secure</code> if its encapsulation is enforced by the language. Otherwise it is open. If the data abstraction is open, the encapsulation should be <strong>enforced by programmer discipline</strong>.</li>
</ul>
</li>
<li><code>Bundling</code><ul>
<li>A data abstraction is <code>unbundled</code> if it defines two kinds of entities, called <strong>value and operation</strong>.</li>
<li>A data abstraction is <code>bundled</code> if it defines just one kind of entity, called <strong>object</strong>, that combines the notion of value and operation. (Which is sometimes called a precedural data abstraction, <code>PDA</code>)</li>
</ul>
</li>
<li><code>Explicit</code><ul>
<li>A data is stateful if it uses <strong>explicit state</strong>. Otherwise it is known as stateless or declarative.</li>
</ul>
</li>
</ul>
<p>We use these three axes, secure, bundling and explit state to organize data abstraction is <code>8</code> ways.</p>
<h3 id="Open_Declarative_Stack">Open Declarative Stack</h3><pre><code>% This <span class="built_in">version</span> is <span class="built_in">open</span>, declarative <span class="operator">and</span> unbundled.

declare    
<span class="built_in">local</span>
     fun {NewStack} nil <span class="function"><span class="keyword">end</span></span>
     fun {Push S E} E|S <span class="function"><span class="keyword">end</span></span>
     fun {Pop S ?E} <span class="keyword">case</span> S <span class="operator">of</span> X|S1 <span class="keyword">then</span> E=X S1 <span class="function"><span class="keyword">end</span> <span class="title">end</span></span>
     fun {IsEmpty S} S==nil <span class="function"><span class="keyword">end</span></span>
<span class="operator">in</span>
     Stack=stack(<span class="built_in">new</span>:NewStack push:Push pop:Pop isEmpty:IsEmpty)
<span class="function"><span class="keyword">end</span></span>
</code></pre><h3 id="Secure_Declarative_Unbundled_Stack">Secure Declarative Unbundled Stack</h3><pre><code>% This <span class="built_in">version</span> is secure, declarative <span class="operator">and</span> unbundled. 

declare
<span class="built_in">local</span> Wrap Unwrap
     {NewWrapper Wrap Unwrap}
     fun {NewStack} {Wrap nil} <span class="function"><span class="keyword">end</span></span>
     fun {Push S E} {Wrap E|{Unwrap S}} <span class="function"><span class="keyword">end</span></span>
     fun {Pop S ?E} <span class="keyword">case</span> {Unwrap S} <span class="operator">of</span> X|S1 <span class="keyword">then</span> E=X {Wrap S1} <span class="function"><span class="keyword">end</span> <span class="title">end</span></span>
     fun {IsEmpty S} {Unwrap S}==nil <span class="function"><span class="keyword">end</span></span>
<span class="operator">in</span>
     Stack=stack(<span class="built_in">new</span>:NewStack push:Push pop:Pop isEmpty:IsEmpty)
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>The stack is unwrapped when entering an ADT and wrapped when the operation exits.</p>
<h3 id="Secure_Declarative_Bundled_Stack">Secure Declarative Bundled Stack</h3><pre><code>% <span class="type">This</span> version is secure, declarative <span class="keyword">and</span> bundled.

<span class="keyword">local</span>
     <span class="keyword">fun</span> {<span class="type">StackObject</span> <span class="type">S</span>}
          <span class="keyword">fun</span> {<span class="type">Push</span> <span class="type">E</span>} {<span class="type">StackObject</span> <span class="type">E</span>|<span class="type">S</span>} <span class="keyword">end</span>
          <span class="keyword">fun</span> {<span class="type">Pop</span> ?<span class="type">E</span>}
               <span class="keyword">case</span> <span class="type">S</span> <span class="keyword">of</span> <span class="type">X</span>|<span class="type">S1</span> <span class="keyword">then</span> <span class="type">E</span>=<span class="type">X</span> {<span class="type">StackObject</span> <span class="type">S1</span>} <span class="keyword">end</span> <span class="keyword">end</span>
          <span class="keyword">fun</span> {<span class="type">IsEmpty</span>} <span class="type">S</span>==<span class="literal">nil</span> <span class="keyword">end</span>
     <span class="keyword">in</span> stack(push:<span class="type">Push</span> pop:<span class="type">Pop</span> isEmpty:<span class="type">IsEmpty</span>) <span class="keyword">end</span>
<span class="keyword">in</span>
     <span class="keyword">fun</span> {<span class="type">NewStack</span>} {<span class="type">StackObject</span> <span class="literal">nil</span>} <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre><p>We can make a data abstraction secure only use <code>higher-order</code> programming instead of using explicit state and name.</p>
<p>Because this version is both secure and bundled, we cansider it as a declarative form of <code>object-oriented programming</code>.</p>
<h3 id="Secure_Stateful_Bundled_Stack">Secure Stateful Bundled Stack</h3><pre><code>% <span class="type">This</span> version <span class="keyword">is</span> secure, stateful <span class="keyword">and</span> bundled.

declare
fun {<span class="type">NewStack</span>}
     C={<span class="type">NewCell</span> <span class="keyword">nil</span>}
     <span class="keyword">proc</span> {<span class="type">Push</span> E} C:=E|@C <span class="keyword">end</span>
     fun {<span class="type">Pop</span>} <span class="keyword">case</span> @C <span class="keyword">of</span> X|<span class="type">S1</span> then C:=<span class="type">S1</span> X <span class="keyword">end</span> <span class="keyword">end</span>
     fun {<span class="type">IsEmpty</span>} @C=<span class="keyword">nil</span> <span class="keyword">end</span>
<span class="keyword">in</span>
     stack(push:<span class="type">Push</span> pop:<span class="type">Pop</span> isEmpty:<span class="type">IsEmpty</span>)
<span class="keyword">end</span>
</code></pre><p>In this version the objectis represented by a recored of procedure values. This version provides the basic functionality of object-oriented programming, namely a group of operations <code>methods</code> with a hidden internal state.</p>
<h3 id="Secure_Stateful_Bundled_Stack_With_Procedure_Dispatching">Secure Stateful Bundled Stack With Procedure Dispatching</h3><pre><code>% <span class="type">This</span> version <span class="keyword">is</span> secure, stateful <span class="keyword">and</span> bundled.

declare
fun {<span class="type">NewStack</span>}
     C={<span class="type">NewCell</span> <span class="keyword">nil</span>}
     <span class="keyword">proc</span> {<span class="type">Push</span> E} C:=E|@C <span class="keyword">end</span>
     fun {<span class="type">Pop</span>} <span class="keyword">case</span> @C <span class="keyword">of</span> X|<span class="type">S1</span> then C:=<span class="type">S1</span> X <span class="keyword">end</span> <span class="keyword">end</span>
     fun {<span class="type">IsEmpty</span>} @C=<span class="keyword">nil</span> <span class="keyword">end</span>
<span class="keyword">in</span>
     <span class="keyword">proc</span> {$ <span class="type">Msg</span>}
          <span class="keyword">case</span> <span class="type">Msg</span>
          <span class="keyword">of</span> push(X) then {<span class="type">Push</span> X}
          [] pop(?E) then E={<span class="type">Pop</span>}
          [] isEmpty(?B) then B={<span class="type">IsEmpty</span>}
     <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre><p>This is called procedure dispatching as opposed to the previous version which uses record dispatching. It is another way to implement secure, stateful bundled stack. With this approach, we use <code>{S.push X}</code> to invocate method <code>push</code>.</p>
<h3 id="Secure_Stateful_Unbundled_Stack">Secure Stateful Unbundled Stack</h3><pre><code>% This <span class="built_in">version</span> is secure, stateful <span class="operator">and</span> unbundled.

declare
<span class="built_in">local</span> Wrap Unwrap
     {NewWrapper Wrap Unwrap}
     fun {NewStack} {Wrap {NewCell nil}} <span class="function"><span class="keyword">end</span></span>
     proc {Push S E} C={Unwrap S} <span class="operator">in</span> C:=E|@C <span class="function"><span class="keyword">end</span></span>
     fun {Pop S}
          C={Unwrap S} <span class="operator">in</span> <span class="keyword">case</span> @C <span class="operator">of</span> X|S1 <span class="keyword">then</span> C:=S1 X <span class="function"><span class="keyword">end</span> <span class="title">end</span></span>
     fun {IsEmpty S} @{Unwrap S}==nil <span class="function"><span class="keyword">end</span></span>
<span class="operator">in</span>
     Stack=stack(<span class="built_in">new</span>:NewStack push:Push pop:Pop isEmpty:IsEmpty)
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>This style is little used in object-oriented programming, but deserves to be more widely known. In this version, we group four operations in a module.</p>
<h2 id="Polymorphism">Polymorphism</h2><p><code>Polymorphism</code> is the ability of an entity to take om many forms. In the context of data abstraction, we say an operation is polymorphic if it works correct for arguments of different types.</p>
<ul>
<li>The <code>object</code> stype has an advantage over the <code>ADT</code> style in that polymorphism is particularly easy to express.</li>
<li>The <code>ADT</code> style gives more freedom to make efficient implementation.</li>
</ul>
<h3 id="An_Example:_Collection_Type">An Example: Collection Type</h3><p>We implement a collection type in both <code>object</code> and <code>ADT</code> style which with three operations.</p>
<p>First, we use <code>ADT</code> to implement the stateful unbundled collection:</p>
<pre><code><span class="built_in">local</span> Wrap Unwrap
    {NewWrapper Wrap Unwrap}
    fun {NewCollection} {Wrap {Stack.<span class="built_in">new</span>}} <span class="function"><span class="keyword">end</span></span>
    proc {Put C X} S={Unwrap C} <span class="operator">in</span> {Stack.push S X} <span class="function"><span class="keyword">end</span></span>
    fun {Get C} S={Unwrap C} <span class="operator">in</span> {Stack.pop S} <span class="function"><span class="keyword">end</span></span>
    fun {IsEmpty C} {Stack.isEmpty {Unwrap C}} <span class="function"><span class="keyword">end</span></span>
<span class="operator">in</span>
    Collection=collection(<span class="built_in">new</span>:NewCollection <span class="built_in">put</span>:Put <span class="built_in">get</span>:Get
                          isEmpty:IsEmpty)
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>Then, implement this with object style:</p>
<pre><code>fun {NewCollection}
    S={NewStack}
    proc {Put X} {S.<span class="built_in">put</span> X} <span class="function"><span class="keyword">end</span></span>
    fun {Get X} {S.pop} <span class="function"><span class="keyword">end</span></span>
    fun {IsEmpty} {S.isEmpty} <span class="function"><span class="keyword">end</span></span>
<span class="operator">in</span>
    collection(<span class="built_in">put</span>:Put <span class="built_in">get</span>:Pop isEmpty:IsEmpty)
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>Now we have out colletion type with both styles, in order to compare the difference between them, let us add an operation <code>union</code> to this collection type.</p>
<h3 id="Adding_a_union_Operation_in_the_ADT_case">Adding a <code>union</code> Operation in the ADT case</h3><p>To implement <code>union</code>, let us introduce a control abstraction:</p>
<pre><code><span class="keyword">proc</span> {<span class="type">DoUntil</span> <span class="type">BF</span> S}
    <span class="keyword">if</span> {<span class="type">BF</span>} then skip <span class="keyword">else</span> {S} {<span class="type">DoUntil</span> <span class="type">BF</span> S} <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre><p>With <code>DoUntil</code>, we can implement the new <code>Collection</code> type as follows.</p>
<pre><code>% <span class="type">Use</span> <span class="type">Internal</span> representations

local <span class="type">Wrap</span> <span class="type">Unwrap</span>
    ...
    <span class="keyword">proc</span> {<span class="type">Union</span> <span class="type">C1</span> <span class="type">C2</span>}
    <span class="type">S1</span>={<span class="type">Unwrap</span> <span class="type">C1</span>} <span class="type">S2</span>={<span class="type">Unwrap</span> <span class="type">C2</span>} <span class="keyword">in</span>
        {<span class="type">DoUntil</span> fun {$} {<span class="type">Stack</span>.isEmpty <span class="type">S2</span>} <span class="keyword">end</span>
        <span class="keyword">proc</span> {$} {<span class="type">Stack</span>.push <span class="type">S1</span> {<span class="type">Stack</span>.pop <span class="type">S2</span>}} <span class="keyword">end</span>}
    <span class="keyword">end</span>
<span class="keyword">in</span>
    <span class="type">Collection</span>=collection(... union:<span class="type">Union</span>)
<span class="keyword">end</span>

% <span class="type">Use</span> external interfaces

local <span class="type">Wrap</span> <span class="type">Unwrap</span>
    ...
    <span class="keyword">proc</span> {<span class="type">Union</span> <span class="type">C1</span> <span class="type">C2</span>}
    <span class="type">S1</span>={<span class="type">Unwrap</span> <span class="type">C1</span>} <span class="type">S2</span>={<span class="type">Unwrap</span> <span class="type">C2</span>} <span class="keyword">in</span>
        {<span class="type">DoUntil</span> fun {$} {<span class="type">Collection</span>.isEmpty <span class="type">S2</span>} <span class="keyword">end</span>
        <span class="keyword">proc</span> {$} {<span class="type">Collection</span>.put <span class="type">S1</span> {<span class="type">Collection</span>.get <span class="type">S2</span>}} <span class="keyword">end</span>}
    <span class="keyword">end</span>
<span class="keyword">in</span>
    <span class="type">Collection</span>=collection(... union:<span class="type">Union</span>)
<span class="keyword">end</span>    
</code></pre><p>We have choice of whether or not to use the internal representation of each collection argument. This gives us the freedom to make a <strong>more efficient implementation</strong>.</p>
<h3 id="Adding_a_union_Operation_in_the_Object_case">Adding a <code>union</code> Operation in the Object case</h3><p>Let us implement <code>union</code> operation in object stype. This is called as <code>{C1 union(C2)}</code>.</p>
<pre><code>% <span class="type">Use</span> internal representation <span class="keyword">of</span> <span class="type">C1</span> but external <span class="keyword">interface</span> <span class="keyword">of</span> <span class="type">C2</span>

fun {<span class="type">NewCollection</span>}
    <span class="type">S1</span>={<span class="type">NewStack</span>}
    ...
    <span class="keyword">proc</span> {<span class="type">Union</span> <span class="type">C2</span>}
        {<span class="type">DoUntil</span> <span class="type">C2</span>.isEmpty
        <span class="keyword">proc</span> {$} {<span class="type">S1</span>.push {<span class="type">C2</span>.get}} <span class="keyword">end</span>}
    <span class="keyword">end</span>
<span class="keyword">in</span>
    collection(... union:<span class="type">Union</span>)
<span class="keyword">end</span>
</code></pre><p>The implementation uses the <strong>internal representation</strong> of <code>C1</code> but the external interface of <code>C2</code>. This is a crucial difference with the <code>ADT</code> stype. We can also use both <strong>external interfaces</strong> to implement this operation again.</p>
<pre><code>% <span class="type">Use</span> external interfaces

fun {<span class="type">NewCollection</span>}
    <span class="type">S1</span>={<span class="type">NewStack</span>}
    ...
    <span class="keyword">proc</span> {<span class="type">Union</span> <span class="type">C2</span>}
        {<span class="type">DoUntil</span> <span class="type">C2</span>.isEmpty
        <span class="keyword">proc</span> {$} {<span class="type">This</span>.push {<span class="type">C2</span>.get}} <span class="keyword">end</span>}
    <span class="keyword">end</span>
    <span class="type">This</span>=collection(... union:<span class="type">Union</span>)
<span class="keyword">in</span>
    <span class="type">This</span>
<span class="keyword">end</span>
</code></pre><p>The object <code>C1</code> refers to itself through the variable <code>This</code>.</p>
<h3 id="Decision_between_ADT_and_Object_styles">Decision between ADT and Object styles</h3><ul>
<li>The <code>ADT</code> style can be more efficient because it allows accessing both internal representations.</li>
<li>Sometimes the <code>ADT</code> style is the only one that works. Especially when we deal with addtion between integer.</li>
<li>The <code>object</code> style provides polyphism “for free”.</li>
<li>The <code>object</code> style is not limited to sequential objects.</li>
<li>The ‘ADT` style provides polymorohism if the language has first-class modules.</li>
<li>If we use the <code>ADT</code> style without first-class modules, then we must write new code to get types to interoperate.</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Programming-Paradigm/">Programming Paradigm</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Abstraction/">Abstraction</a><a href="/tags/Polymorphism/">Polymorphism</a><a href="/tags/State/">State</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/16/Message-Passing-Concurrency/" title="Message-Passing Concurrency" itemprop="url">Message-Passing Concurrency</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-15T17:13:25.000Z" itemprop="datePublished"> 發表於 2015-03-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><code>Message-passing</code> is a programming style in which a program consists of independent entities that interact by sending each other messages asynchronously.</p>
<h2 id="Why_Message-passing_important?">Why Message-passing important?</h2><ul>
<li>It is the basic framework for <strong>multi-agent</strong> systems.</li>
<li>It is the natural stype for a <strong>distributed</strong> system.</li>
<li>It lends itself well to building highly reliable systems.</li>
</ul>
<h2 id="Message-passing_concurrent_model">Message-passing concurrent model</h2><p>The message-passing concurrent model extends the declarative concurrent model by adding ports. We add two operions to manipulate ports.</p>
<pre><code>{NewPort &lt;y&gt; &lt;x&gt;}  Port creation: <span class="built_in">create</span> <span class="operator">a</span> <span class="built_in">new</span> port <span class="operator">with</span> entry point &lt;x&gt; <span class="operator">and</span> stream &lt;y&gt;
{Send &lt;x&gt; &lt;y&gt;}     Port <span class="built_in">send</span>: append &lt;y&gt; <span class="built_in">to</span> he stream corresponding <span class="built_in">to</span> <span class="operator">the</span> entry point &lt;x&gt;
</code></pre><h2 id="Port_Objects">Port Objects</h2><p>A <code>port object</code> is a combination of one or more ports and a stream object. This extends stream objects in two ways.</p>
<ol>
<li><strong>Many-to-one communication</strong> is possible, many threads can reference a given port object and send message to it independently.</li>
<li>Port objects can be <strong>embedded inside data structures</strong>.</li>
</ol>
<p>In message-passing model, a program consists of a set of port objects sending and receiving messages. </p>
<ul>
<li>Port objects can create new port objects. </li>
<li>Port objects can send messages containing references to other port objects.</li>
</ul>
<h3 id="NewPortObject_abstraction">NewPortObject abstraction</h3><p>We can define an abstraction to make it easier to program with port objects.</p>
<pre><code>fun {NewPortObject Init Fun}
<span class="built_in">Sin</span> Sout <span class="keyword">in</span>
    thread {FoldL <span class="built_in">Sin</span> FUn Init Sout} <span class="keyword">end</span>
    {NewPort <span class="built_in">Sin</span>}
<span class="keyword">end</span>
fun {NewPortObject2 Proc}
<span class="built_in">Sin</span> <span class="keyword">in</span>
    thread <span class="keyword">for</span> Msg <span class="keyword">in</span> <span class="built_in">Sin</span> <span class="keyword">do</span> {Proc Msg} <span class="keyword">end</span> <span class="keyword">end</span>
    {NewPort <span class="built_in">Sin</span>}
<span class="keyword">end</span>
</code></pre><h2 id="Message_Protocol">Message Protocol</h2><p>We can use message-passing paradigm to model simple message protocol.</p>
<h3 id="RMI">RMI</h3><p><code>RMI</code> is the most popular of the simple protocols. It allows to call another object in a different operating system process.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">ServerProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> calc(X Y) then
        Y=X*X+<span class="number">2</span>.<span class="number">0</span>*X+<span class="number">2</span>.<span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Server</span>={<span class="type">NewPortObject2</span> <span class="type">ServerProc</span>}

<span class="keyword">proc</span> {<span class="type">ClientProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> work(Y) then <span class="type">Y1</span> <span class="type">Y2</span> <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">1</span>.<span class="number">0</span> <span class="type">Y1</span>)}
        {<span class="type">Wait</span> <span class="type">Y1</span>}
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">2</span>.<span class="number">0</span> <span class="type">Y1</span>)}
        {<span class="type">Wait</span> <span class="type">Y2</span>}
        Y=<span class="type">Y1</span>+<span class="type">Y2</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Client</span>={<span class="type">NewPortObject2</span> <span class="type">ClientProc</span>}
{<span class="type">Browse</span> {<span class="type">Send</span> <span class="type">Client</span> work($)}}

// <span class="number">15</span>
</code></pre><h3 id="Asynchronous_RMI">Asynchronous RMI</h3><p>This protocol is similar to <code>RMI</code>, except that the client continues immediately after sending the request. The client is informed when the reply arrives. Multiple requests can be handled in rapid succession.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">ClientProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> work(?Y) then <span class="type">Y1</span> <span class="type">Y2</span> <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">1</span>.<span class="number">0</span> <span class="type">Y1</span>)}
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">2</span>.<span class="number">0</span> <span class="type">Y1</span>)}
        Y=<span class="type">Y1</span>+<span class="type">Y2</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Client</span>={<span class="type">NewPortObject2</span> <span class="type">ClientProc</span>}
{<span class="type">Browse</span> {<span class="type">Send</span> <span class="type">Client</span> work($)}}
// <span class="number">15</span>
</code></pre><p>Requests are handled by the server the same order as they are sent and replies arrive in that order as well.</p>
<h3 id="RMI_with_callback">RMI with callback</h3><p>Here is a server that does a callback to find the value of a special value <code>delta</code> only known by the client.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">ServerProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> calc(X ?Y <span class="type">Client</span>) then <span class="type">X1</span> D <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Client</span> delta(D)}
        <span class="type">X1</span>=X+D
        Y=<span class="type">X1</span>*<span class="type">X1</span>+<span class="number">2</span>.<span class="number">0</span>*<span class="type">X1</span>+<span class="number">2</span>.<span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Server</span>={<span class="type">NewPortObject2</span> <span class="type">ServerProc</span>}

<span class="keyword">proc</span> {<span class="type">ClientProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> work(?Z) then Y <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">10</span>.<span class="number">0</span> Y <span class="type">Client</span>)}
        Z=Y+<span class="number">100</span>.<span class="number">0</span>
    [] delta(?D) then
        D=<span class="number">1</span>.<span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Client</span>={<span class="type">NewPortObject2</span> <span class="type">ClientProc</span>}
{<span class="type">Browse</span> {<span class="type">Send</span> <span class="type">Client</span> work($)}}

// _
</code></pre><p>This solution not work, because the client suspends when it calls th server, so that the server cannot call the client.</p>
<h4 id="Using_thread">Using thread</h4><p>First, we use concurrency to solve this problem.</p>
<pre><code>proc {ClientProc Msg}
    <span class="keyword">case</span> Msg
    <span class="operator">of</span> work(?Z) <span class="keyword">then</span> Y <span class="operator">in</span>
        {Send Server calc(<span class="number">10.0</span> Y Client)}
        thread Z=Y+<span class="number">100.0</span> <span class="function"><span class="keyword">end</span></span>
    [] delta(?D) <span class="keyword">then</span>
        D=<span class="number">1.0</span>
    <span class="function"><span class="keyword">end</span></span>
<span class="function"><span class="keyword">end</span></span>
<span class="comment">
// 245.0</span>
</code></pre><p>After the client sent a message to the server, it does not suspend, because the <code>thread</code> creates a new thread and execute it on it.</p>
<h4 id="Using_record_continuation">Using record continuation</h4><p>Instead of using thread, we can use record to solve this issue. In this way, the client never waits and deadlock is avoiding.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">ServerProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> calc(X <span class="type">Client</span> <span class="type">Cont</span>) then <span class="type">X1</span> D Y <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Client</span> delta(D)}
        <span class="type">X1</span>=X+D
        Y=<span class="type">X1</span>*<span class="type">X1</span>+<span class="number">2</span>.<span class="number">0</span>*<span class="type">X1</span>+<span class="number">2</span>.<span class="number">0</span>
        {<span class="type">Send</span> <span class="type">Client</span> <span class="type">Cont</span><span class="comment">#Y}</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Server</span>={<span class="type">NewPortObject2</span> <span class="type">ServerProc</span>}

<span class="keyword">proc</span> {<span class="type">ClientProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> work(?Z) then Y <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">10</span>.<span class="number">0</span> <span class="type">Client</span> cont(Z))}
    [] cont(Z)<span class="comment">#Y then</span>
        Z=Y+<span class="number">100</span>.<span class="number">0</span>
    [] delta(?D) then
        D=<span class="number">1</span>.<span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="type">Client</span>={<span class="type">NewPortObject2</span> <span class="type">ClientProc</span>}
{<span class="type">Browse</span> {<span class="type">Send</span> <span class="type">Client</span> work($)}}

// <span class="number">245</span>.<span class="number">0</span>
</code></pre><p>When we pass <code>work</code> message to <code>client</code> it immediately send <code>server</code> message <code>calc</code>. After the server execute <code>calc</code>, it pass back <code>Cont#Y</code> back to the client, then client finishes the calculation.</p>
<h4 id="Using_procedure_continuation">Using procedure continuation</h4><p>The previous example can be generalized in a powerful way by passing a precedure instead of a record.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">ClientProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> work(?Z) then
        C=<span class="keyword">proc</span> {$ Y} Z=Y+<span class="number">100</span>.<span class="number">0</span> <span class="keyword">end</span>
    <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">10</span>.<span class="number">0</span> <span class="type">Client</span> cont(C))}
    [] cont(C)<span class="comment">#Y then</span>
        {C Y}
    [] delta(?D) then
        D=<span class="number">1</span>.<span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre><p>The continuation contains the work that the client has to do after the server returns. Since the continuation is a procedure value, it is self-contained, it can be executed by anyone without knowing anything inside it.    </p>
<h4 id="Asynchronous_RMI_with_callback">Asynchronous RMI with callback</h4><p>We might want to do two asynchronous RMIs where each <code>RMI</code> does a callback.</p>
<pre><code><span class="keyword">proc</span> {<span class="type">ServerProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> calc(X ?Y <span class="type">Client</span>) then <span class="type">X1</span> D <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Client</span> delta(D)}
        thread 
            <span class="type">X1</span>=X+D
            Y=<span class="type">X1</span>*<span class="type">X1</span>+<span class="number">2</span>.<span class="number">0</span>*<span class="type">X1</span>+<span class="number">2</span>.<span class="number">0</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">proc</span> {<span class="type">ClientProc</span> <span class="type">Msg</span>}
    <span class="keyword">case</span> <span class="type">Msg</span>
    <span class="keyword">of</span> work(?Z) then <span class="type">Y1</span> <span class="type">Y2</span> <span class="keyword">in</span>
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">10</span>.<span class="number">0</span> <span class="type">Y1</span> <span class="type">Client</span>)}
        {<span class="type">Send</span> <span class="type">Server</span> calc(<span class="number">20</span>.<span class="number">0</span> <span class="type">Y2</span> <span class="type">Client</span>)}
        thread Y=<span class="type">Y1</span>+<span class="type">Y2</span> <span class="keyword">end</span>
    [] delta(?D) then
        D=<span class="number">1</span>.<span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre><h4 id="Double_callback">Double callback</h4><p>When the server does a first callback to client, and which itself calls a second callback to the server. To handle this, both the client and the server should response immediately and not wait until the result come back.</p>
<pre><code>proc {ServerProc Msg}
    <span class="keyword">case</span> Msg
    <span class="operator">of</span> calc(X ?Y Client) <span class="keyword">then</span> X1 D <span class="operator">in</span>
        {Send Client delta(D)}
        thread 
            X1=X+D
            Y=X1*X1+<span class="number">2.0</span>*X1+<span class="number">2.0</span>
        <span class="function"><span class="keyword">end</span></span>
    <span class="function"><span class="keyword">end</span></span>
    [] serverdelta(?S) <span class="keyword">then</span>
        S=<span class="number">0.01</span>
    <span class="function"><span class="keyword">end</span></span>
<span class="function"><span class="keyword">end</span></span>

proc {ClientProc Msg}
    <span class="keyword">case</span> Msg
    <span class="operator">of</span> work(?Z) <span class="keyword">then</span> Y <span class="operator">in</span>
        {Send Server calc(<span class="number">10.0</span> Y Client)}
        thread Z=Y+<span class="number">100.0</span> <span class="function"><span class="keyword">end</span></span>
    [] delta(?D) <span class="keyword">then</span> S <span class="operator">in</span>
        {Send Server serverdelta(S)}
        thread D=<span class="number">1.0</span>+S <span class="function"><span class="keyword">end</span></span>
    <span class="function"><span class="keyword">end</span></span>
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>Calling <code>{Send Client work(Z)}</code> calls the server, which calls the client method <code>delta(D)</code>, which iteself calls the server method <code>serverdelta(?S)</code>.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Concurrency/">Concurrency</a><a href="/tags/Message-Passing/">Message Passing</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/15/分治策略/" title="分治策略" itemprop="url">分治策略</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-03-15T07:14:54.000Z" itemprop="datePublished"> 發表於 2015-03-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>在计算机科学中, <a href="http://zh.wikipedia.org/wiki/%E5%88%86%E6%B2%BB%E6%B3%95" target="_blank" rel="external">分治法</a>是基于多项分支递归的一种很重要的算法范式. 字面上的解释是”分而治之”, 就是把一个复杂的问题分成两个或更多的相同或相似的子问题, 知道最后子问题可以简单的直接求解, 原问题的解就是子问题的解的合并.</p>
</blockquote>
<h2 id="分治法的步骤">分治法的步骤</h2><ol>
<li>分解: 将问题划分为一些子问题, 子问题的形式与原问题相同, <strong>只是规模更小</strong>.</li>
<li>解决: <strong>递归</strong>地求解出子问题. </li>
<li>合并: 将子问题的解<strong>合并</strong>.</li>
</ol>
<h2 id="求解递归式的方法">求解递归式的方法</h2><ol>
<li>代入法</li>
<li>递归树法</li>
<li>主方法</li>
</ol>
<p>在这里我们不对前两种方法进行说明, 仅仅讨论一下主方法的使用, 以及适用的情况.</p>
<h3 id="主方法">主方法</h3><p>主方法<code>(Master Method)</code>可以求解一下形式的递归式的边界.</p>
<pre><code><span class="function"><span class="title">T</span><span class="params">(n)</span></span> = <span class="function"><span class="title">aT</span><span class="params">(n/b)</span></span> + <span class="function"><span class="title">f</span><span class="params">(n)</span></span>
</code></pre><p>其中 <code>a &gt;= 1</code> <code>b &gt; 1</code> <code>f(n)</code> 是一个给定的函数. 这个递归式刻画了一个如下的分治算法:</p>
<blockquote>
<p>生成 <code>a</code> 个子问题, 每个子问题的规模是原问题规模的 <code>1/b</code> , 分解和合并步骤总共消耗 <code>f(n)</code> 的时间.</p>
</blockquote>
<h4 id="使用">使用</h4><ol>
<li>求出 <code>c = log(b,a)</code> </li>
<li>比较 <code>n^c</code> 与 <code>f(n)</code> 的大小<ul>
<li>如果前者<strong>多项式</strong>的小于后者, 那么该递归式的边界为 <code>Θ(f(n))</code>.</li>
<li>如果前者<strong>多项式</strong>的大于后者, 那么该递归式的边界为 <code>Θ(n^log(b,a))</code>.</li>
<li>如果两者<strong>多项式</strong>意义上的相等, 那么只需要乘上一个对数因子 <code>lgn</code>, ex, <code>T(n) = T(n/2) + 1 =&gt; Θ(lgn)</code></li>
</ul>
</li>
</ol>
<h4 id="总结">总结</h4><p>恰当运用主方法可以解决大多数的递归式边界问题, 但是当两项非多项式意义上的小于或者大于, 那么就不能使用主方法求解, ex, <code>T(n)=2T(n/2)+n/lgn</code></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法导论/">算法导论</a>►<a class="article-category-link" href="/categories/算法导论/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/01/27/HTTP报文内的HTTP信息.md/" title="HTTP报文内的HTTP信息" itemprop="url">HTTP报文内的HTTP信息</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2015-01-27T04:17:20.000Z" itemprop="datePublished"> 發表於 2015-01-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="HTTP报文">HTTP报文</h2><p><code>HTTP报文</code>是由多行数据构成的字符串文本, 大致可分为<strong>报文首部</strong>和<strong>报文主体</strong>两部分.</p>
<pre><code><span class="code">------------------
|     报文首部     |
------------------</span>
<span class="header">|  空行(CR + LF)  |
------------------</span>
|                |
|     报文主体    |
<span class="header">|                | 
------------------</span>
</code></pre><p>请求报文和响应报文的主要区别在于<strong>请求行</strong>和<strong>状态行</strong>的不同.</p>
<pre><code><span class="attribute">请求报文首部 </span>=<span class="string"> 请求行 + 请求首部字段 + 通用首部字段 + 实体首部字段 + 其他
响应报文首部 = 响应行 + 响应首部字段 + 响应首部字段 + 实体首部字段 + 其他</span>
</code></pre><p>可以通过<code>Range</code>字段获取部分内容的范围请求</p>
<pre><code><span class="attribute">Range</span>: <span class="string">bytes=5001-10000</span>
<span class="attribute">Range</span>: <span class="string">bytes=5001-</span>
<span class="attribute">Range</span>: <span class="string">bytes=-3000, 5000-7000</span>
</code></pre><p>当Web界面有多份相同的内容时, 根据浏览器的默认语言会返回不同的界面, 例如中文版或者英文版, 这样的机制就叫做<strong>内容协商</strong>.</p>
<p><strong>内容协商</strong>就是客户端和服务端对响应的资源内容进行交涉, 返回合适的内容, 具体有以下三种类型.</p>
<ul>
<li>服务端驱动协商(Server-driven Negotiation)</li>
<li>客户端驱动协商(Client-driven Negotiation)</li>
<li>透明协商(Transparent Negotiation)</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/HTTP/">HTTP</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/FP/" title="FP">FP<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Haskell/" title="Haskell">Haskell<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Haskell/ML/" title="ML">ML<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Paradigm/" title="Programming Paradigm">Programming Paradigm<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/FP/Scheme/" title="Scheme">Scheme<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/" title="算法导论">算法导论<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/算法/" title="算法">算法<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/FP/" title="FP">FP<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Scheme/" title="Scheme">Scheme<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/OOP/" title="OOP">OOP<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/HTTP/" title="HTTP">HTTP<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Polymorphism/" title="Polymorphism">Polymorphism<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Runtime/" title="Runtime">Runtime<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/segue/" title="segue">segue<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/堆/" title="堆">堆<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SICP/" title="SICP">SICP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/subtype/" title="subtype">subtype<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/generic/" title="generic">generic<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Concurrency/" title="Concurrency">Concurrency<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Message-Passing/" title="Message Passing">Message Passing<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Haskell/" title="Haskell">Haskell<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ML/" title="ML">ML<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/List/" title="List">List<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Pattern-Match/" title="Pattern Match">Pattern Match<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Iteration/" title="Iteration">Iteration<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="http://deltax.me/about" target="_blank" title="Draven">Draven</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>












<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
