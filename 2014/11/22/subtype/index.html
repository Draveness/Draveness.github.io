
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Subtype | DeltaX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Draven">
    

    
    <meta name="description" content="Subtyping
While languages like Java and C# have generics these days, the source of type-system expressiveness most fundamental to object-oriented style is subtype polymorphism, also known as subtyping">
<meta property="og:type" content="article">
<meta property="og:title" content="Subtype">
<meta property="og:url" content="http://deltax.me/2014/11/22/subtype/index.html">
<meta property="og:site_name" content="DeltaX">
<meta property="og:description" content="Subtyping
While languages like Java and C# have generics these days, the source of type-system expressiveness most fundamental to object-oriented style is subtype polymorphism, also known as subtyping">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Subtype">
<meta name="twitter:description" content="Subtyping
While languages like Java and C# have generics these days, the source of type-system expressiveness most fundamental to object-oriented style is subtype polymorphism, also known as subtyping">

    
    <link rel="alternative" href="/atom.xml" title="DeltaX" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="DeltaX" title="DeltaX"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="DeltaX">DeltaX</a></h1>
				<h2 class="blog-motto">为了成为牛逼闪闪的工程师</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:deltax.me">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/11/22/subtype/" title="Subtype" itemprop="url">Subtype</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://deltax.me/about" title="Draven" target="_blank" itemprop="author">Draven</a>
		
  <p class="article-time">
    <time datetime="2014-11-22T12:26:08.000Z" itemprop="datePublished"> 發表於 2014-11-22</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Subtyping"><span class="toc-number">1.</span> <span class="toc-text">Subtyping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Depth_Subtyping"><span class="toc-number">2.</span> <span class="toc-text">Depth Subtyping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function_Subtyping"><span class="toc-number">3.</span> <span class="toc-text">Function Subtyping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subtype_for_OOP"><span class="toc-number">4.</span> <span class="toc-text">Subtype for OOP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generics_Versus_Subtyping"><span class="toc-number">5.</span> <span class="toc-text">Generics Versus Subtyping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Subtyping_is_a_Bad_Substitute_for_Generics"><span class="toc-number">5.1.</span> <span class="toc-text">Subtyping is a Bad Substitute for Generics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What_is_Subtyping_Good_For?"><span class="toc-number">5.2.</span> <span class="toc-text">What is Subtyping Good For?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Generics_are_a_Bad_Substitute_for_Subtyping"><span class="toc-number">5.3.</span> <span class="toc-text">Generics are a Bad Substitute for Subtyping</span></a></li></ol></li></ol>
		
		</div>
		
		<h2 id="Subtyping">Subtyping</h2><ul>
<li>While languages like <code>Java</code> and <code>C#</code> have generics these days, the source of type-system expressiveness most fundamental to object-oriented style is <em>subtype polymorphism</em>, also known as <em>subtyping</em>.</li>
</ul>
<p>We need a type system, with a form of types for records and typing rules for each of our expressions.</p>
<ul>
<li>If <code>e1</code> has type <code>t1</code>, <code>e2</code> has type <code>t2</code>, …, <code>en</code> has type <code>tn</code>, then <code>{f1=e1, f2=e2, ..., fn=en}</code> has type <code>{f1:t1, f2:t2, ..., fn:tn}</code>.</li>
<li>If <code>e</code> has a record type containing <code>f : t</code>, then <code>e.f</code> has type <code>t</code> (else <code>e.f</code> does not type-check).</li>
<li>If <code>e1</code> has a record type containing <code>f : t</code> and <code>e2</code> has type <code>t</code>,then <code>e1.f = e2</code> has type <code>t</code> (else <code>e1.f = e2</code> does not type-check).</li>
<li>“Width” subtyping: A supertype can have a subset of fields with the same types, i.e., a subtype can have <strong>“extra”</strong> fields</li>
<li>“Permutation” subtyping: A supertype can have the same set of fields with the same types in a different order.</li>
<li>Transitivity: If <code>t1 &lt;: t2</code> and <code>t2 &lt;: t3</code>, then <code>t1 &lt;: t3</code>.</li>
<li>Reflexivity: Every type is a subtype of itself: <code>t &lt;: t</code>.</li>
</ul>
<hr>
<h2 id="Depth_Subtyping">Depth Subtyping</h2><ul>
<li>“Depth” subtyping: If <code>ta &lt;: tb</code>, then <code>{f1:t1,...,f:ta,...,fn:tn} &lt;: {f1:t1,...,f:tb,...,fn:tn}</code>.</li>
</ul>
<p>This rule breaks out type system, allowing programs that we do not want to allow to type-check!</p>
<p>Another way to look at the issue is that given the three features of (1) setting a field, (2) letting depth subtyping change the type of a field, and (3) having a type system actually prevent field-missing errors, you can have any two of the three.</p>
<hr>
<h2 id="Function_Subtyping">Function Subtyping</h2><p> The rules for when one function tyoe is a subtype of another function type are even less intuitive than the issue of depth subtyping for records, but we should understand them to safely override methods in <code>OOP</code> languages.</p>
<pre><code><span class="comment">// (({x:real,y:real}-&gt;{x:real,y:real}) * {x:real,y:real}) -&gt; real</span>

fun distMoved (<span class="string">f :</span> {<span class="string">x:</span>real,<span class="string">y:</span>real}-&gt;{<span class="string">x:</span>real,<span class="string">y:</span>real},
           <span class="string">p :</span> {<span class="string">x:</span>real,<span class="string">y:</span>real}) =
   let val <span class="string">p2 :</span> {<span class="string">x:</span>real,<span class="string">y:</span>real} = f p
       val <span class="string">dx :</span> real = p2.x - p.x
       val <span class="string">dy :</span> real = p2.y - p.y
   <span class="keyword">in</span> Math.sqrt(dx*dx + dy*dy) end

fun flip p = {x=~p.x, y=~p.y}
val d = distMoved(flip, {x=<span class="number">3.0</span>, y=<span class="number">4.0</span>})
</code></pre><p>It is safe to pass in a function with a return type that promises more, such as return a <code>subtype</code> of the needed reuturn type.</p>
<pre><code>// {x:real,y:real} -&gt; {x:real,y:real,color:string}

fun flipGreen <span class="variable">p =</span> {<span class="variable">x=</span>~p.x, <span class="variable">y=</span>~p.y, <span class="variable">color=</span><span class="string">"green"</span>}
val <span class="variable">d =</span> distMoved(flipGreen, {<span class="variable">x=</span><span class="number">3.0</span>, <span class="variable">y=</span><span class="number">4.0</span>})
</code></pre><blockquote>
<p>In general, the rule is that if <code>ta &lt;: tb</code>, then t -&gt;ta &lt;: t -&gt; tb</p>
</blockquote>
<p>But it turns out it works just fine to use a function that “need less of its argument” in place of that “need more of its argument”.</p>
<pre><code>// {x:real} -&gt; {x:real,y:real}

fun flipX_Y0 <span class="variable">p =</span> {<span class="variable">x=</span>~p.x, <span class="variable">y=</span><span class="number">0.0</span>}
val <span class="variable">d =</span> distMoved(flipX_Y0, {<span class="variable">x=</span><span class="number">3.0</span>, <span class="variable">y=</span><span class="number">4.0</span>})
</code></pre><blockquote>
<p> In general, the rule is that if <code>tb &lt;: ta</code>, then ta -&gt; t &lt;: tb -&gt; t</p>
</blockquote>
<p>The technical jargon for “backwords” is <em>contravariance</em>, meaning the subtyping for argument is the reverse of the subtyping for the types overall.</p>
<p>Function subtyping also allow contravariance of arguments and convariance of results.</p>
<pre><code>// {x:real} -&gt; {x:real,y:real,color:string}

fun flipXMakeGreen <span class="variable">p =</span> {<span class="variable">x=</span>~p.x, <span class="variable">y=</span><span class="number">0.0</span>, <span class="variable">color=</span><span class="string">"green"</span>}
val <span class="variable">d =</span> distMoved(flipXMakeGreen, {<span class="variable">x=</span><span class="number">3.0</span>, <span class="variable">y=</span><span class="number">4.0</span>})
</code></pre><p><code>{x:real} -&gt; {x:real,y:real,color:string}</code> is a subtype of <code>{x:real, y:real} -&gt; {x:real, y:real}</code>, because <code>{x:real,y:real} &lt;: {x:real}</code> (contravariance on arguments) and <code>{x:real,y:real,color:string} &lt;: {x:real,y:real}</code> (covariance on results).</p>
<blockquote>
<p>The general rule for this subtype is If <code>t3 &lt;: t1</code> and <code>t2 &lt;: t4</code>, then <code>t1-&gt;t2 &lt;: t3-&gt;t4</code>.</p>
</blockquote>
<hr>
<h2 id="Subtype_for_OOP">Subtype for OOP</h2><p>An object is a record holding mutable fields methods. We assume methods are immutable. With this perspective, sound subtyping for objects follows sound subtyping for records and functions.</p>
<ul>
<li>A subtype can have extra fields</li>
<li>a subtype cannot have a different type for a field because it is mutable.</li>
<li>A subtype can have extra methods.</li>
<li>Because methods are immutable, a subtype can have a subtype for a method, which means the method in the subtype can have contravariant argument types and a covariant result type.</li>
</ul>
<p>In particular, the <code>object-oriented</code> implement is more restrictive than subtyping requires.</p>
<ul>
<li>A subclass can add fields but not remove them.</li>
<li>A subclass can add methods but not remove them.</li>
<li>A subclass can override a method with a covariant return type.</li>
<li>A class can implement more methods than an interface requires or implement a required method with covariant return type.</li>
</ul>
<p><code>Classes</code> and <code>types</code> and different things,</p>
<hr>
<h2 id="Generics_Versus_Subtyping">Generics Versus Subtyping</h2><p>There are functions that combine other functions as compse:</p>
<pre><code>val compose : <span class="function"><span class="params">(’b -&gt; ’c)</span> * <span class="params">(’a -&gt; ’b)</span> -&gt;</span> (’a<span class="function"> -&gt;</span> ’c)
</code></pre><p>Generic types are much more useful and precise than just saying that some argument can be<br>“anything” </p>
<h3 id="Subtyping_is_a_Bad_Substitute_for_Generics">Subtyping is a Bad Substitute for Generics</h3><p>Consider Java code example:</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">LamePair</span> </span>{
  <span class="built_in">Object</span> x;
  <span class="built_in">Object</span> y;
  LamePair(<span class="built_in">Object</span> _x, <span class="built_in">Object</span> _y){ x=_x; y=_y; }
  LamePair swap() { <span class="keyword">return</span> <span class="keyword">new</span> LamePair(y,x); }
  ...
}

<span class="built_in">String</span> s = (<span class="built_in">String</span>)(<span class="keyword">new</span> LamePair(<span class="string">"hi"</span>,<span class="number">4</span>).y); <span class="comment">// error caught only at run-time</span>
</code></pre><p>Subtyping does not work that way, the type-checker only knows that the field holds an <code>Object</code>. So we have to use a <code>downcast</code>, cast the <code>Object</code> type to <code>String</code>. Such <code>downcast</code> costs in terms of performance, but may cause a failure.</p>
<h3 id="What_is_Subtyping_Good_For?">What is Subtyping Good For?</h3><p>A generally agreed upon example where subtyping works well is graphical user interfaces. Much of the code for graphics libraries works fine for any sort of graphical element (“paint it on the screen,” “change the background color,” “report if the mouse is clicked on it,” etc.) where different elements such as buttons, slider bars, or text boxes can then be subtypes.</p>
<h3 id="Generics_are_a_Bad_Substitute_for_Subtyping">Generics are a Bad Substitute for Subtyping</h3><p>In a language with generics instead of subtyping, you can code up your own code reuse with higher-order functions, but it can be quite a bit of trouble for a simple idea.</p>
<pre><code><span class="keyword">fun</span> distToOrigin2(getx,gety,v) =
<span class="keyword">let</span>
    <span class="keyword">val</span> x = getx v
    <span class="keyword">val</span> y = gety v
<span class="keyword">in</span>
    <span class="type">Math</span>.sqrt (x*x + y*y)
<span class="keyword">end</span>
<span class="keyword">fun</span> distToOriginPt (p : {x:<span class="built_in">real</span>,y:<span class="built_in">real</span>}) =
    distToOrigin2(<span class="keyword">fn</span> v =&gt; #x v,
                  <span class="keyword">fn</span> v =&gt; #y v, p)
<span class="keyword">fun</span> distToOriginColorPt (p : {x:<span class="built_in">real</span>,y:<span class="built_in">real</span>,color:<span class="built_in">string</span>}) =
    distToOrigin2(<span class="keyword">fn</span> v =&gt; #x v,
                   <span class="keyword">fn</span> v =&gt; #y v, 
                   p)
</code></pre>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Programming-Paradigm/">Programming Paradigm</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/generic/">generic</a><a href="/tags/subtype/">subtype</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://deltax.me/2014/11/22/subtype/" data-title="Subtype | DeltaX" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/11/23/iOS Combine View and TableView<Bug01>/" title="iOS Combine View and TableView &lt;Bug01&gt;">
  <strong>上一篇：</strong><br/>
  <span>
  iOS Combine View and TableView &lt;Bug01&gt;</span>
</a>
</div>


<div class="next">
<a href="/2014/11/22/Multiple Inheritence/"  title="Multiple Inheritance">
 <strong>下一篇：</strong><br/> 
 <span>Multiple Inheritance
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Subtyping"><span class="toc-number">1.</span> <span class="toc-text">Subtyping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Depth_Subtyping"><span class="toc-number">2.</span> <span class="toc-text">Depth Subtyping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function_Subtyping"><span class="toc-number">3.</span> <span class="toc-text">Function Subtyping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subtype_for_OOP"><span class="toc-number">4.</span> <span class="toc-text">Subtype for OOP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generics_Versus_Subtyping"><span class="toc-number">5.</span> <span class="toc-text">Generics Versus Subtyping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Subtyping_is_a_Bad_Substitute_for_Generics"><span class="toc-number">5.1.</span> <span class="toc-text">Subtyping is a Bad Substitute for Generics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What_is_Subtyping_Good_For?"><span class="toc-number">5.2.</span> <span class="toc-text">What is Subtyping Good For?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Generics_are_a_Bad_Substitute_for_Subtyping"><span class="toc-number">5.3.</span> <span class="toc-text">Generics are a Bad Substitute for Subtyping</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/FP/" title="FP">FP<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Haskell/" title="Haskell">Haskell<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Haskell/ML/" title="ML">ML<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Paradigm/" title="Programming Paradigm">Programming Paradigm<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/FP/Scheme/" title="Scheme">Scheme<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法导论/" title="算法导论">算法导论<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/FP/" title="FP">FP<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Scheme/" title="Scheme">Scheme<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/算法/" title="算法">算法<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/HTTP/" title="HTTP">HTTP<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/OOP/" title="OOP">OOP<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Runtime/" title="Runtime">Runtime<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/segue/" title="segue">segue<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/堆/" title="堆">堆<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SICP/" title="SICP">SICP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/subtype/" title="subtype">subtype<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/generic/" title="generic">generic<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Polymorphism/" title="Polymorphism">Polymorphism<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Concurrency/" title="Concurrency">Concurrency<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Message-Passing/" title="Message Passing">Message Passing<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Haskell/" title="Haskell">Haskell<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ML/" title="ML">ML<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/List/" title="List">List<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Pattern-Match/" title="Pattern Match">Pattern Match<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Iteration/" title="Iteration">Iteration<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Draven. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/https://github.com/Draveness" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:stark.draven@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="http://deltax.me/about" target="_blank" title="Draven">Draven</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
    
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
